---
id: about-openmetrics-explorer
title: OpenMetrics íƒìƒ‰ê¸°
description:  OpenMetrics íƒìƒ‰ê¸° ê°€ì´ë“œì…ë‹ˆë‹¤.
toc_max_heading_level: 3
keywords: [ OpenMetrics íƒìƒ‰ê¸° ]
---

<Cmdname sid="openmetrics_explorer" className="uitext" />ëŠ” WhaTapì—ì„œ ì œê³µí•˜ëŠ” ë©”íŠ¸ë¦­ ë°ì´í„° ì¡°íšŒ ë° ì‹œê°í™” ë„êµ¬ì…ë‹ˆë‹¤.
ìˆ˜ì§‘ëœ ë©”íŠ¸ë¦­ì„ PromQLë¡œ ì¡°íšŒí•˜ê³ , ê²°ê³¼ë¥¼ ì°¨íŠ¸(Graph)ì™€ í…Œì´ë¸”(Table)ë¡œ ì‹œê°í™”í•©ë‹ˆë‹¤.

#### ì£¼ìš” ê¸°ëŠ¥

- PromQL ì¿¼ë¦¬ë¥¼ í†µí•œ ë©”íŠ¸ë¦­ ì¡°íšŒ
- Graph/Table ë·°ë¡œ ë°ì´í„° ì‹œê°í™”
- ì‹œê°„ ë²”ìœ„ ì„ íƒ ì‹œ ìë™ìœ¼ë¡œ promqlì— ì‹œê°„ ì…ë ¥
- ì‹¤ì‹œê°„ ë©”íŠ¸ë¦­ ëª¨ë‹ˆí„°ë§

#### í™”ë©´ êµ¬ì„±

- ìƒë‹¨: ì‹œê°„ ë²”ìœ„ ì„ íƒê¸°, ì¿¼ë¦¬ ì…ë ¥ì°½
- ì¤‘ì•™: Graph/Table/Stacked Bar ë·° ì „í™˜ ë²„íŠ¼
- í•˜ë‹¨: ì¡°íšŒ ê²°ê³¼ í‘œì‹œ (ê·¸ë˜í”„ ë˜ëŠ” í…Œì´ë¸”)

---

#### ì™œ PromQLì´ í•„ìš”í•œê°€ìš”?

OpenMetricsëŠ” Prometheus ë©”íŠ¸ë¦­ í¬ë§·ì„ ê¸°ë°˜ìœ¼ë¡œ ë‹¤ì–‘í•œ ì‹œìŠ¤í…œê³¼ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ì‹œê³„ì—´ ì§€í‘œë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤. PrometheusëŠ” ì˜¤í”ˆì†ŒìŠ¤ ëª¨ë‹ˆí„°ë§ ë„êµ¬ë¡œ, CPU ì‚¬ìš©ë¥ , ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰, HTTP ìš”ì²­ ìˆ˜, ì—ëŸ¬ìœ¨ ë“±ê³¼ ê°™ì€ ìˆ˜ì¹˜ ê¸°ë°˜ì˜ ì‹œê°„ íë¦„ ë°ì´í„°ë¥¼ ë©”íŠ¸ë¦­ ì§€í‘œë¡œ ì €ì¥í•©ë‹ˆë‹¤.

ì´ëŸ¬í•œ ì§€í‘œë“¤ì€ ëŒ€ë¶€ë¶„ ìˆ˜ì´ˆ ë‹¨ìœ„ë¡œ ì§€ì†ì ìœ¼ë¡œ ìˆ˜ì§‘ë˜ë©°, ì‹œê°„ì— ë”°ë¼ ëŠì„ì—†ì´ ë³€í™”í•˜ëŠ” 'ì‹œê³„ì—´ ë°ì´í„°(time-series data)'ì˜ í˜•íƒœë¥¼ ê°€ì§‘ë‹ˆë‹¤.

í•˜ì§€ë§Œ ë‹¨ìˆœíˆ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ëŠ” ê²ƒë§Œìœ¼ë¡œ "ì§€ê¸ˆ ì„œë¹„ìŠ¤ê°€ ì •ìƒì¸ê°€?", "ì—ëŸ¬ ë¹„ìœ¨ì´ í‰ì†Œë³´ë‹¤ ë†’ì•„ì¡ŒëŠ”ê°€?", "ì–´ë–¤ APIê°€ ëŠë ¤ì¡ŒëŠ”ê°€?" ê°™ì€ ì˜ë¯¸ ìˆëŠ” ë¶„ì„ì´ ì–´ë µìŠµë‹ˆë‹¤.

ê·¸ë˜ì„œ <Cmdname sid="openmetrics_explorer" className="uitext" />ì—ì„œ ìˆ˜ì§‘ëœ ë©”íŠ¸ë¦­ì„ ë¶„ì„í•  ìˆ˜ ìˆëŠ” ì¿¼ë¦¬ ì–¸ì–´ê°€ í•„ìš”í•˜ê³ , ê·¸ ì—­í• ì„ í•˜ëŠ” ê²ƒì´ ë°”ë¡œ <strong>PromQL(Prometheus Query Language)</strong>ì…ë‹ˆë‹¤.

PromQLì„ ì‚¬ìš©í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ë¶„ì„ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.

- **ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§**: í˜„ì¬ ì‹œìŠ¤í…œ ìƒíƒœë¥¼ ì¦‰ì‹œ í™•ì¸ (í˜„ì¬ CPU ì‚¬ìš©ë¥ , í™œì„± ì‚¬ìš©ì ìˆ˜ ë“±)
- **ì¶”ì„¸ ë¶„ì„**: ì‹œê°„ì— ë”°ë¥¸ ë³€í™” íŒ¨í„´ íŒŒì•… (ìµœê·¼ 1ì‹œê°„ ë™ì•ˆ ì´ˆë‹¹ ìš”ì²­ ìˆ˜ ì¦ê°€ìœ¨)
- **ë¹„êµ ë¶„ì„**: ì—¬ëŸ¬ ì„œë²„ë‚˜ ì„œë¹„ìŠ¤ ê°„ì˜ ì§€í‘œ ë¹„êµ (ì„œë²„ë³„ ì—ëŸ¬ìœ¨, ì§€ì—­ë³„ ì‘ë‹µ ì‹œê°„)
- **ì§‘ê³„ ë° ê³„ì‚°**: ë³µì¡í•œ ìˆ˜í•™ ì—°ì‚°ê³¼ í†µê³„ ê³„ì‚° (ì „ì²´ ì—ëŸ¬ìœ¨, í‰ê·  ì‘ë‹µ ì‹œê°„, ìƒìœ„ 10ê°œ ëŠë¦° API)
- **ì•Œë¦¼ ì¡°ê±´ ì„¤ì •**: íŠ¹ì • ì„ê³„ê°’ ì´ˆê³¼ ì‹œ ìë™ ì•Œë¦¼ (ì—ëŸ¬ìœ¨ 5% ì´ìƒ, ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥  90% ì´ìƒ)

---

## PromQL ì‚¬ìš©ì ê°€ì´ë“œ

### ì¿¼ë¦¬ ì‹¤í–‰ ë°©ì‹

| ì¿¼ë¦¬ | ì„¤ëª… |
| --- | --- |
| **Instant Query (ì¦‰ì‹œ ì¿¼ë¦¬)** | íŠ¹ì • ì‹œì ì˜ ë°ì´í„°ë¥¼ ì¡°íšŒí•¨. Table íƒ­ì—ì„œ ì‚¬ìš©ë¨ |
| **Range Query (ë²”ìœ„ ì¿¼ë¦¬)** | ì‹œì‘ ì‹œê°„ê³¼ ì¢…ë£Œ ì‹œê°„ ì‚¬ì´ì˜ ë°ì´í„°ë¥¼ ì¼ì •í•œ ê°„ê²©ìœ¼ë¡œ ì¡°íšŒí•¨ |

### ë°ì´í„° íƒ€ì…

PromQL í‘œí˜„ì‹ì€ 4ê°€ì§€ íƒ€ì…ìœ¼ë¡œ í‰ê°€ë©ë‹ˆë‹¤.

| íƒ€ì… | ì„¤ëª… |
| --- | --- |
| **Instant Vector** | ê° ì‹œê³„ì—´ì—ì„œ ë‹¨ì¼ ìƒ˜í”Œì„ í¬í•¨í•˜ëŠ” ì‹œê³„ì—´ ì§‘í•© (ëª¨ë‘ ë™ì¼í•œ íƒ€ì„ìŠ¤íƒ¬í”„) |
| **Range Vector** | ê° ì‹œê³„ì—´ì—ì„œ ì‹œê°„ ë²”ìœ„ì˜ ë°ì´í„° í¬ì¸íŠ¸ë¥¼ í¬í•¨í•˜ëŠ” ì‹œê³„ì—´ ì§‘í•© |
| **Scalar** | ë‹¨ìˆœí•œ ìˆ«ì ê°’ |
| **String** | ë‹¨ìˆœí•œ ë¬¸ìì—´ ê°’ |

### ê¸°ë³¸ ì‚¬ìš©ë²•

#### 1. ë©”íŠ¸ë¦­ ì„ íƒ(Instant Vector Selectors)

**ê¸°ë³¸ ë©”íŠ¸ë¦­ ì¡°íšŒ**

```
nginx_http_response_count_total
```

**ë ˆì´ë¸” í•„í„°ë§**

```
nginx_http_response_count_total{status="200"}
```

**ì—¬ëŸ¬ ë ˆì´ë¸” ì¡°ê±´**

```
nginx_http_response_count_total{method="GET", status="200"}
```

#### 2. ë ˆì´ë¸” ë§¤ì¹­ ì—°ì‚°ì

| ì—°ì‚°ì | ì„¤ëª… |
| :--: | --- |
| = | ë ˆì´ë¸” ê°’ì´ ì •í™•íˆ ì¼ì¹˜ |
| != | ë ˆì´ë¸” ê°’ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŒ |
| =~ | ë ˆì´ë¸” ê°’ì´ ì •ê·œí‘œí˜„ì‹ê³¼ ì¼ì¹˜ |
| !~ | ë ˆì´ë¸” ê°’ì´ ì •ê·œí‘œí˜„ì‹ê³¼ ì¼ì¹˜í•˜ì§€ ì•ŠìŒ |

**ì •ê·œí‘œí˜„ì‹ ì˜ˆì œ**

```
# staging, testing, development í™˜ê²½ë§Œ ì¡°íšŒ
nginx_http_response_count_total{environment=~"staging|testing|development"}

# GET ë©”ì†Œë“œë¥¼ ì œì™¸í•œ ëª¨ë“  ë©”ì†Œë“œ
nginx_http_response_count_total{method!="GET"}

# repë¡œ ì‹œì‘í•˜ëŠ” replica ì¡°íšŒ
nginx_http_response_count_total{replica=~"rep.*"}
```

#### 3. ì‹œê°„ ë²”ìœ„ ì„ íƒ(Range Vector Selectors)

í˜„ì¬ ì‹œì ë¶€í„° ê³¼ê±° íŠ¹ì • ê¸°ê°„ì˜ ë°ì´í„°ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.

```
# ìµœê·¼ 5ë¶„ê°„ì˜ ë°ì´í„°
nginx_http_response_count_total[5m]

# ìµœê·¼ 1ì‹œê°„ì˜ ë°ì´í„°
nginx_http_response_count_total{status="200"}[1h]
```

#### 4. ì‹œê°„ ì˜¤í”„ì…‹(Offset Modifier)

ê³¼ê±° íŠ¹ì • ì‹œì ì˜ ë°ì´í„°ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤.

```
# 5ë¶„ ì „ì˜ ê°’
nginx_http_response_count_total offset 5m

# 1ì£¼ì¼ ì „ì˜ 5ë¶„ê°„ ë¹„ìœ¨
rate(nginx_http_response_count_total[5m] offset 1w)

# ë¯¸ë˜ ë¹„êµ (ìŒìˆ˜ offset)
rate(nginx_http_response_count_total[5m] offset -1w)
```

### ì‹¤ìš© ì˜ˆì œ

**ì˜ˆì œ 1: ìƒíƒœ ì½”ë“œë³„ ìš”ì²­ ìˆ˜ ì¡°íšŒ**

```
nginx_http_response_count_total{instance="http://192.168.100.122:4040/metrics"}
```

**ì˜ˆì œ 2: íŠ¹ì • ìƒíƒœ ì½”ë“œë§Œ ì¡°íšŒ**

```
# 200 ì‘ë‹µë§Œ
nginx_http_response_count_total{status="200"}

# 4xx ì—ëŸ¬ë§Œ(ì •ê·œí‘œí˜„ì‹)
nginx_http_response_count_total{status=~"4.."}

# 5xx ì—ëŸ¬ë§Œ
nginx_http_response_count_total{status=~"5.."}
```

**ì˜ˆì œ 3. ë©”ì†Œë“œì™€ ìƒíƒœ ì½”ë“œ ì¡°í•©**

```
# GET ìš”ì²­ ì¤‘ 200 ì‘ë‹µ
nginx_http_response_count_total{method="GET", status="200"}

# POST, PUT, DELETE ìš”ì²­ ì¤‘ 404 ì‘ë‹µ
nginx_http_response_count_total{method=~"POST|PUT|DELETE", status="404"}
```

**ì˜ˆì œ 4. ë©”íŠ¸ë¦­ ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰**

```
# "job:"ë¡œ ì‹œì‘í•˜ëŠ” ëª¨ë“  ë©”íŠ¸ë¦­
{__name__=~"job:.*"}

# nginxë¡œ ì‹œì‘í•˜ëŠ” ëª¨ë“  ë©”íŠ¸ë¦­
{__name__=~"nginx.*"}
```

**ì˜ˆì œ 5. ìµœê·¼ ì‹œê°„ ë²”ìœ„ ë°ì´í„°**

```
# ìµœê·¼ 5ë¶„ê°„ì˜ nginx ì‘ë‹µ
nginx_http_response_count_total{status="200"}[5m]

# ìµœê·¼ 1ì‹œê°„ì˜ 404 ì—ëŸ¬
nginx_http_response_count_total{status="404"}[1h]
```

**ì˜ˆì œ 6. ì‹œê°„ëŒ€ ë¹„êµ**

```
# í˜„ì¬ ê°’ê³¼ 1ì‹œê°„ ì „ ê°’ ë¹„êµ
nginx_http_response_count_total{status="200"}
nginx_http_response_count_total{status="200"} offset 1h

# ì–´ì œ ê°™ì€ ì‹œê°„ì˜ ë°ì´í„°
nginx_http_response_count_total offset 1d
```

### ì§‘ê³„ í•¨ìˆ˜ 

ì§‘ê³„ í•¨ìˆ˜(Aggregation Functions)ëŠ” ì—¬ëŸ¬ ì‹œê³„ì—´ ë°ì´í„°ë¥¼ í•˜ë‚˜ë¡œ ê²°í•©í•˜ì—¬ ê³„ì‚°í•©ë‹ˆë‹¤.

#### sum() 

ëª¨ë“  ì‹œê³„ì—´ì˜ ê°’ì„ ë”í•©ë‹ˆë‹¤.

```
# ëª¨ë“  ì¸ìŠ¤í„´ìŠ¤ì˜ ìš”ì²­ ìˆ˜ í•©ê³„
sum(nginx_http_response_count_total)

# ìƒíƒœ ì½”ë“œë³„ë¡œ ê·¸ë£¹í™”í•˜ì—¬ í•©ê³„
sum by (status) (nginx_http_response_count_total)

# ì¸ìŠ¤í„´ìŠ¤ë³„ë¡œ ê·¸ë£¹í™”í•˜ì—¬ í•©ê³„
sum by (instance) (nginx_http_response_count_total)
```

#### avg()

ëª¨ë“  ì‹œê³„ì—´ì˜ **í‰ê· **ê°’ì„ ê³„ì‚°í•©ë‹ˆë‹¤.

```
# ëª¨ë“  ì¸ìŠ¤í„´ìŠ¤ì˜ í‰ê·  ì‘ë‹µ ìˆ˜
avg(nginx_http_response_count_total)

# ìƒíƒœ ì½”ë“œë³„ í‰ê· 
avg by (status) (nginx_http_response_count_total)
```

#### count()

ì‹œê³„ì—´ì˜ **ê°œìˆ˜**ë¥¼ ì…‰ë‹ˆë‹¤.

```
# ì „ì²´ ì‹œê³„ì—´ ê°œìˆ˜
count(nginx_http_response_count_total)

# ìƒíƒœ ì½”ë“œë³„ ì‹œê³„ì—´ ê°œìˆ˜
count by (status) (nginx_http_response_count_total)
```

#### max() / min()

ì‹œê³„ì—´ì˜ **ìµœëŒ€ê°’ê³¼ ìµœì†Œê°’**ì„ ê³„ì‚°í•©ë‹ˆë‹¤.

```
# ìµœëŒ€ê°’
max(nginx_http_response_count_total)

# ìµœì†Œê°’
min(nginx_http_response_count_total)

# ìƒíƒœ ì½”ë“œë³„ ìµœëŒ€ê°’
max by (status) (nginx_http_response_count_total)
```

#### topk() / bottomk() 

ì§€ì •í•œ ìˆ˜(K)ë§Œí¼ **ìƒìœ„** ë˜ëŠ” **í•˜ìœ„** ì‹œê³„ì—´ì„ ë°˜í™˜í•©ë‹ˆë‹¤. 

```
# ìƒìœ„ 5ê°œ ì‹œê³„ì—´
topk(5, nginx_http_response_count_total)

# í•˜ìœ„ 3ê°œ ì‹œê³„ì—´
bottomk(3, nginx_http_response_count_total)

# ìƒíƒœ ì½”ë“œë³„ ìƒìœ„ 3ê°œ
topk(3, sum by (status) (nginx_http_response_count_total))
```

### ì‹œê³„ì—´ í•¨ìˆ˜

#### rate()

**ê°€ì¥ ë§ì´ ì‚¬ìš©ë˜ëŠ” í•¨ìˆ˜**ë¡œ, Counter ë©”íŠ¸ë¦­ì˜ **ì´ˆë‹¹ í‰ê·  ì¦ê°€ìœ¨**ì„ ê³„ì‚°í•©ë‹ˆë‹¤.

```
# ìµœê·¼ 5ë¶„ê°„ ì´ˆë‹¹ í‰ê·  ìš”ì²­ ìˆ˜
rate(nginx_http_response_count_total[5m])

# ìƒíƒœ ì½”ë“œ 200ì˜ ì´ˆë‹¹ í‰ê·  ìš”ì²­ ìˆ˜
rate(nginx_http_response_count_total{status="200"}[5m])

# ëª¨ë“  ì¸ìŠ¤í„´ìŠ¤ì˜ ì´ˆë‹¹ ì´ ìš”ì²­ ìˆ˜
sum(rate(nginx_http_response_count_total[5m]))
```

:::caution 

**ì£¼ì˜ì‚¬í•­**

- Counter ë©”íŠ¸ë¦­ì—ë§Œ ì‚¬ìš©
- ì‹œê°„ ë²”ìœ„ëŠ” ìŠ¤í¬ë© ê°„ê²©ì˜ ìµœì†Œ 2ë°° ì´ìƒ ê¶Œì¥ (ì˜ˆ: ìŠ¤í¬ë© ê°„ê²© 30ì´ˆ â†’ [1m] ì´ìƒ)
- ì¹´ìš´í„° ë¦¬ì…‹(ì„œë²„ ì¬ì‹œì‘ ë“±)ì„ ìë™ìœ¼ë¡œ ì²˜ë¦¬

:::

#### increase()

ì§€ì •í•œ ì‹œê°„ ë²”ìœ„ ë™ì•ˆì˜ **ì´ ì¦ê°€ëŸ‰**ì„ ê³„ì‚°í•©ë‹ˆë‹¤.

```
# ìµœê·¼ 5ë¶„ê°„ ì´ ìš”ì²­ ìˆ˜
increase(nginx_http_response_count_total[5m])

# ìµœê·¼ 1ì‹œê°„ ë™ì•ˆì˜ ì—ëŸ¬ ìˆ˜
increase(nginx_http_response_count_total{status=~"5.."}[1h])
```

**rate()ì™€ increase()ì˜ ê´€ê³„**  

`increase(v[5m]) = rate(v[5m]) Ã— 300ì´ˆ`

- rate(): ì´ˆë‹¹ ë¹„ìœ¨
- increase(): ì ˆëŒ€ ì¦ê°€ëŸ‰

#### irate()

ë§ˆì§€ë§‰ ë‘ ë°ì´í„° í¬ì¸íŠ¸ë¥¼ ê¸°ë°˜ìœ¼ë¡œ **ì´ˆë‹¹ ìˆœê°„ ì¦ê°€ìœ¨**ì„ ê³„ì‚°í•©ë‹ˆë‹¤.

```
# ì¦‰ì‹œ ì¦ê°€ìœ¨
irate(nginx_http_response_count_total[5m])
```

**irate() vs rate()**

- irate(): ë¹ ë¥´ê²Œ ë³€í•˜ëŠ” ì¹´ìš´í„°ì— ì í•©, ì§§ì€ ìŠ¤íŒŒì´í¬ ê°ì§€
- rate(): ì•Œë¦¼ ë° ëŠë¦¬ê²Œ ë³€í•˜ëŠ” ì¹´ìš´í„°ì— ì í•©, í‰ê· ê°’ ì œê³µ

### ì‹œê°„ ë²”ìœ„ í•¨ìˆ˜ 

íŠ¹ì • ì‹œê°„ ë²”ìœ„ ë‚´ì—ì„œ ê°’ì„ ì§‘ê³„í•©ë‹ˆë‹¤.

#### avg_over_time() 

**ì‹œê°„ ë²”ìœ„ í‰ê· ** í•¨ìˆ˜ì…ë‹ˆë‹¤.

```
# ìµœê·¼ 10ë¶„ê°„ í‰ê· ê°’
avg_over_time(nginx_http_response_count_total[10m])
```

#### max_over_time() / min_over_time() 

ì§€ì •í•œ ì‹œê°„ì˜ **ìµœëŒ€/ìµœì†Œê°’**ì„ ê³„ì‚°í•˜ëŠ” ì‹œê°„ ë²”ìœ„ í•¨ìˆ˜ì…ë‹ˆë‹¤.

```
# ìµœê·¼ 1ì‹œê°„ ë™ì•ˆ ìµœëŒ€ê°’
max_over_time(nginx_http_response_count_total[1h])

# ìµœê·¼ 1ì‹œê°„ ë™ì•ˆ ìµœì†Œê°’
min_over_time(nginx_http_response_count_total[1h])
```

#### sum_over_time() 

ì§€ì •í•œ ê¸°ê°„ì˜ ê°’ì„ ë”í•œ **ì‹œê°„ ë²”ìœ„ í•©ê³„** í•¨ìˆ˜ì…ë‹ˆë‹¤.

```
# ìµœê·¼ 5ë¶„ê°„ ëª¨ë“  ê°’ì˜ í•©
sum_over_time(nginx_http_response_count_total[5m])
```

### ì¤‘ìš” ê·œì¹™: Rate then Sum

ì´ ê·œì¹™ì€ Counter ë©”íŠ¸ë¦­ì— rate(), increase(), irate() ê°™ì€ ì‹œê³„ì—´ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•  ë•Œ ëª¨ë“  ì§‘ê³„ í•¨ìˆ˜(sum, avg, max, min, count ë“±)ì— ì ìš©ë©ë‹ˆë‹¤.

:::caution

**í•­ìƒ rate() ë¨¼ì €, ê·¸ ë‹¤ìŒ sum()**

Counter ë©”íŠ¸ë¦­ì„ ì§‘ê³„í•  ë•Œ ë°˜ë“œì‹œ ì´ ìˆœì„œë¥¼ ì§€ì¼œì•¼ í•©ë‹ˆë‹¤.

:::

ğŸ”µ **ì˜¬ë°”ë¥¸ ë°©ë²•**

```
# rate()ë¥¼ ë¨¼ì € ì ìš©í•œ í›„ sum()
sum(rate(nginx_http_response_count_total[5m]))
```

âŒ **ì˜ëª»ëœ ë°©ë²•**

```
# sum()ì„ ë¨¼ì € í•˜ë©´ ì¹´ìš´í„° ë¦¬ì…‹ ì‹œ ë¬¸ì œ ë°œìƒ
rate(sum(nginx_http_response_count_total[5m]))
```
Counter ë©”íŠ¸ë¦­ì„ sum()ìœ¼ë¡œ ë¨¼ì € í•©ì¹˜ë©´, ê°œë³„ ì„œë²„ì˜ ì¹´ìš´í„° ë¦¬ì…‹(ì¬ì‹œì‘)ì„ ê°ì§€í•  ìˆ˜ ì—†ê²Œ ë©ë‹ˆë‹¤. ì„œë²„ í•œ ëŒ€ê°€ ì¬ì‹œì‘ë˜ë©´ ì „ì²´ í•©ê³„ê°€ ê°‘ìê¸° ê°ì†Œí•˜ê³ , rate()ëŠ” ì´ë¥¼ ìŒìˆ˜ ì¦ê°€ìœ¨ì´ë‚˜ ë¹„ì •ìƒì ì¸ ìŠ¤íŒŒì´í¬ë¡œ ì˜ëª» ê³„ì‚°í•©ë‹ˆë‹¤. ë°˜ë©´ rate()ë¥¼ ë¨¼ì € ì ìš©í•˜ë©´ ê° ì„œë²„ë³„ë¡œ ì¹´ìš´í„° ë¦¬ì…‹ì„ ì •í™•íˆ ê°ì§€í•˜ê³  ì²˜ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ì‹¤ì „ ì˜ˆì œ

**ì˜ˆì œ 1. ì´ˆë‹¹ ìš”ì²­ ìˆ˜ (RPS) ê³„ì‚°**

```
# ì „ì²´ RPS
sum(rate(nginx_http_response_count_total[5m]))

# ìƒíƒœ ì½”ë“œë³„ RPS
sum by (status) (rate(nginx_http_response_count_total[5m]))

# ë©”ì†Œë“œë³„ RPS
sum by (method) (rate(nginx_http_response_count_total[5m]))
```

:::info

**ì „ì²´ Requests Per Second(RPS) PromQLì— ëŒ€í•œ ì„¤ëª…**

sum(rate(nginx_http_response_count_total[5m]))ì´ ì™œ RPSì¼ê¹Œ?

1. nginx_http_response_count_totalì€??
   - Counter ë©”íŠ¸ë¦­: ì„œë²„ ì‹œì‘ ì´í›„ ëˆ„ì  ì‘ë‹µ ìˆ˜
   - ì˜ˆ: 1000 â†’ 1050 â†’ 1120 â†’ 1180 â†’ 1250...

2. rate(...[5m])ì€ ë¬´ì—‡ì¼ê¹Œ?
   - ìµœê·¼ 5ë¶„ê°„ ë°ì´í„°ë¥¼ ë³´ê³  ì´ˆë‹¹ í‰ê·  ì¦ê°€ìœ¨ ê³„ì‚°
   - ì˜ˆì‹œ:
     5ë¶„ ì „: 1000
     í˜„ì¬: 1300
     ì°¨ì´: 300ê°œ (5ë¶„ = 300ì´ˆ)
     rate = 300 / 300ì´ˆ = 1.0 requests/second
   
   â†’ rate()ì˜ ê²°ê³¼ = ì´ˆë‹¹ ìš”ì²­ ìˆ˜ (RPS)

3. sum()ì€ ì™œ í•„ìš”í•œê°€?
   - ì—¬ëŸ¬ ì„œë²„/ë ˆì´ë¸”ì˜ rate ê°’ì„ ëª¨ë‘ ë”í•¨
   - ì˜ˆ:
     server1, status=200 â†’ 10 req/s
     server1, status=404 â†’ 2 req/s
     server2, status=200 â†’ 15 req/s
     server2, status=404 â†’ 3 req/s
     í•©ê³„ = 30 req/s

ê²°ë¡ : 
sum(rate(nginx_http_response_count_total[5m])) = ëª¨ë“  ì„œë²„ì˜ ì´ˆë‹¹ ì´ ìš”ì²­ ìˆ˜ (RPS)  

<br />

> ì°¸ê³ . 5ë¶„ê°„ ì´ ìš”ì²­ ìˆ˜ë¥¼ ì›í•˜ë©´ increase() ì‚¬ìš©
sum(increase(nginx_http_response_count_total[5m])) = 5ë¶„ê°„ ì´ ìš”ì²­ ìˆ˜

:::

**ì˜ˆì œ 2. ì—ëŸ¬ìœ¨ ê³„ì‚°**

```
# ì „ì²´ ìš”ì²­ ëŒ€ë¹„ 5xx ì—ëŸ¬ ë¹„ìœ¨ (%)
sum(rate(nginx_http_response_count_total{status=~"5.."}[5m])) / sum(rate(nginx_http_response_count_total[5m])) * 100

# ì „ì²´ ìš”ì²­ ëŒ€ë¹„ 4xx ì—ëŸ¬ ë¹„ìœ¨
sum(rate(nginx_http_response_count_total{status=~"4.."}[5m])) / sum(rate(nginx_http_response_count_total[5m]))
```

**ì˜ˆì œ 3. ìƒìœ„ Nê°œ ì¸ìŠ¤í„´ìŠ¤ ì°¾ê¸°**

```
# ìš”ì²­ì´ ê°€ì¥ ë§ì€ ìƒìœ„ 5ê°œ ì¸ìŠ¤í„´ìŠ¤
topk(5, sum by (instance) (rate(nginx_http_response_count_total[5m])))

# ì—ëŸ¬ê°€ ê°€ì¥ ë§ì€ ìƒìœ„ 3ê°œ ì¸ìŠ¤í„´ìŠ¤
topk(3, sum by (instance) (rate(nginx_http_response_count_total{status=~"5.."}[5m])))
```

**ì˜ˆì œ 4. ì‹œê°„ëŒ€ë³„ ë¹„êµ**

```
# í˜„ì¬ RPS
sum(rate(nginx_http_response_count_total[5m]))

# 1ì‹œê°„ ì „ RPS
sum(rate(nginx_http_response_count_total[5m] offset 1h))

# ì–´ì œ ê°™ì€ ì‹œê°„ RPS
sum(rate(nginx_http_response_count_total[5m] offset 1d))
```

**ì˜ˆì œ 5. í‰ê·  ì‘ë‹µ ìˆ˜**

```
# ì¸ìŠ¤í„´ìŠ¤ë³„ í‰ê·  ì‘ë‹µ ìˆ˜
avg by (instance) (rate(nginx_http_response_count_total[5m]))

# ìƒíƒœ ì½”ë“œë³„ í‰ê· 
avg by (status) (rate(nginx_http_response_count_total[5m]))
```

### ìˆ˜í•™ ì—°ì‚°ì

#### ì‚°ìˆ  ì—°ì‚°

```
# ë”í•˜ê¸°
sum(rate(nginx_http_response_count_total{status="200"}[5m]))
+
sum(rate(nginx_http_response_count_total{status="201"}[5m]))

# ë¹¼ê¸°
sum(rate(nginx_http_response_count_total[5m])) - sum(rate(nginx_http_response_count_total{status=~"5.."}[5m]))

# ê³±í•˜ê¸° (ë°”ì´íŠ¸ë¥¼ MBë¡œ ë³€í™˜)
nginx_http_response_size_bytes / 1024 / 1024

# ë‚˜ëˆ„ê¸° (ë¹„ìœ¨ ê³„ì‚°)
sum(rate(nginx_http_response_count_total{status=~"5.."}[5m])) / sum(rate(nginx_http_response_count_total[5m]))

```

#### ë¹„êµ ì—°ì‚°

```
# 100ë³´ë‹¤ í° ê°’ë§Œ
nginx_http_response_count_total > 100

# íŠ¹ì • ê°’ê³¼ ê°™ì€ ê²½ìš°
nginx_http_response_count_total == 200

# ë²”ìœ„ ì§€ì •
nginx_http_response_count_total > 100 and nginx_http_response_count_total < 1000
```

### ì‹¤ì „ íŒ

**1. ìŠ¤í¬ë©(ìˆ˜ì§‘ ì£¼ê¸°)ë³„ ì‹œê°„ ë²”ìœ„ ì„ íƒ**

| ìŠ¤í¬ë© ê°„ê²© | ìµœì†Œ ì‹œê°„ ë²”ìœ„ | ê¶Œì¥ ì‹œê°„ ë²”ìœ„ | ì´ìœ  |
| :---: | :---: | :---: | --- |
| 15ì´ˆ | [30s] | [1m] ì´ìƒ | 2~4ê°œ ë°ì´í„° í¬ì¸íŠ¸ í™•ë³´ |
| 30ì´ˆ | [1m] | [2m] ì´ìƒ | 2~4ê°œ ë°ì´í„° í¬ì¸íŠ¸ í™•ë³´ |
| 1ë¶„ | [2m] | [5m] ì´ìƒ | 2~4ê°œ ë°ì´í„° í¬ì¸íŠ¸ í™•ë³´ |

**2. ê·¸ë£¹í™” ë ˆì´ë¸” ì„ íƒ**

```
# ë„ˆë¬´ ì„¸ë¶„í™” (ë„ˆë¬´ ë§ì€ ì‹œê³„ì—´)
sum by (instance, method, status, path) (rate(nginx_http_response_count_total[5m]))

# ì ì ˆí•œ ê·¸ë£¹í™”
sum by (status) (rate(nginx_http_response_count_total[5m]))
```

**3. ì•Œë¦¼ ê·œì¹™ ì‘ì„± ì‹œ**

```
# 5ë¶„ê°„ ì—ëŸ¬ìœ¨ì´ 5% ì´ìƒì¸ ê²½ìš°
sum(rate(nginx_http_response_count_total{status=~"5.."}[5m])) / sum(rate(nginx_http_response_count_total[5m]))
> 0.05
```

**4. í•¨ìˆ˜ ì¡°í•© ìˆœì„œ**

```
# 1. rate() ë¨¼ì €
# 2. ì§‘ê³„ í•¨ìˆ˜ (sum, avg ë“±)
# 3. ìˆ˜í•™ ì—°ì‚°

# ì˜¬ë°”ë¥¸ ìˆœì„œ
sum(rate(nginx_http_response_count_total[5m])) * 100
```

### ê¸°íƒ€ í•¨ìˆ˜

#### abs()

ê°’ì˜ **ì ˆëŒ€ê°’**ì„ ë°˜í™˜í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.

```
abs(rate(nginx_http_response_count_total[5m]) - 100)
```

#### round()

ê°’ì„ ê°€ì¥ ê°€ê¹Œìš´ ì •ìˆ˜ ë˜ëŠ” ì§€ì •í•œ ë‹¨ìœ„ë¡œ **ë°˜ì˜¬ë¦¼**í•©ë‹ˆë‹¤.

```
# ì†Œìˆ˜ì  ë°˜ì˜¬ë¦¼
round(sum(rate(nginx_http_response_count_total[5m])))

# 10 ë‹¨ìœ„ë¡œ ë°˜ì˜¬ë¦¼
round(sum(rate(nginx_http_response_count_total[5m])), 10)
```

#### clamp_max() / clamp_min()

ê°’ì´ ì§€ì •í•œ **ìµœëŒ€ê°’ì´ë‚˜ ìµœì†Œê°’ì„ ë„˜ì§€ ì•Šë„ë¡ ì œí•œ**í•©ë‹ˆë‹¤.

```
# ìµœëŒ€ê°’ 1000ìœ¼ë¡œ ì œí•œ
clamp_max(nginx_http_response_count_total, 1000)

# ìµœì†Œê°’ 0ìœ¼ë¡œ ì œí•œ
clamp_min(nginx_http_response_count_total, 0)
```

### ì£¼ì˜ì‚¬í•­

#### ë¹ˆ ë ˆì´ë¸” ê°’ ë§¤ì¹­

ë¹ˆ ë ˆì´ë¸” ê°’ì„ ë§¤ì¹­í•˜ë©´ í•´ë‹¹ ë ˆì´ë¸”ì´ ì„¤ì •ë˜ì§€ ì•Šì€ ëª¨ë“  ì‹œê³„ì—´ë„ ì„ íƒë©ë‹ˆë‹¤.

```
# environment ë ˆì´ë¸”ì´ ì—†ê±°ë‚˜ ë¹ˆ ê°’ì¸ ëª¨ë“  ì‹œê³„ì—´
nginx_http_response_count_total{environment=""}
```

#### í•„ìˆ˜ ì„ íƒì

ë²¡í„° ì„ íƒìëŠ” ë°˜ë“œì‹œ ë©”íŠ¸ë¦­ ì´ë¦„ì´ë‚˜ ë¹ˆ ë¬¸ìì—´ê³¼ ì¼ì¹˜í•˜ì§€ ì•ŠëŠ” ë ˆì´ë¸” ë§¤ì²˜ë¥¼ í•˜ë‚˜ ì´ìƒ ì§€ì •í•´ì•¼ í•©ë‹ˆë‹¤.


```
# âŒ ì˜ëª»ëœ ì˜ˆ
{job=~".*"}

# âœ… ì˜¬ë°”ë¥¸ ì˜ˆ
{job=~".+"}
{job=~".*", method="get"}
```

#### ì„±ëŠ¥ ê³ ë ¤ì‚¬í•­

**íš¨ìœ¨ì ì¸ ì¿¼ë¦¬ë¥¼ ìœ„í•œ íŒ**

ë©”íŠ¸ë¦­ ì´ë¦„ë§Œ ì‚¬ìš©í•˜ë©´ ìˆ˜ì²œ ê°œì˜ ì‹œê³„ì—´ì´ ì„ íƒë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    - í•­ìƒ ì ì ˆí•œ ë ˆì´ë¸” í•„í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ ê²°ê³¼ë¥¼ ì œí•œí•˜ì„¸ìš”.
    - ì²˜ìŒì—ëŠ” Table ë·°ì—ì„œ ê²°ê³¼ë¥¼ í™•ì¸í•˜ê³ , ì ì ˆí•œ ìˆ˜ì¤€ìœ¼ë¡œ í•„í„°ë§í•œ í›„ ì°¨íŠ¸ ë·°ë¡œ ì „í™˜í•˜ì„¸ìš”.
    - ìˆ˜ë°± ê°œ ì´í•˜ì˜ ì‹œê³„ì—´ì´ ì´ìƒì ì…ë‹ˆë‹¤.

#### Staleness (ì˜¤ë˜ëœ ë°ì´í„°)

ì‹œê³„ì—´ì´ ë” ì´ìƒ ìˆ˜ì§‘ë˜ì§€ ì•Šìœ¼ë©´ "stale"ë¡œ í‘œì‹œë©ë‹ˆë‹¤.
- Staleë¡œ í‘œì‹œëœ í›„ì—ëŠ” ì¿¼ë¦¬ ê²°ê³¼ì— í¬í•¨ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
- ê¸°ë³¸ì ìœ¼ë¡œ 5ë¶„ ë™ì•ˆ ë°ì´í„°ê°€ ìˆ˜ì§‘ë˜ì§€ ì•Šìœ¼ë©´ staleë¡œ ê°„ì£¼ë©ë‹ˆë‹¤.

### ì •ê·œí‘œí˜„ì‹

PrometheusëŠ” RE2 ë¬¸ë²•ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
- ëª¨ë“  ì •ê·œí‘œí˜„ì‹ì€ ì™„ì „íˆ ì•µì»¤ë§ë©ë‹ˆë‹¤. (ìë™ìœ¼ë¡œ `^`ì™€ `$`ê°€ ì¶”ê°€ë¨)
- `env=~"foo"`ëŠ” `env=~"^foo$"`ì™€ ë™ì¼í•©ë‹ˆë‹¤.

### ì£¼ì„

```
# ì´ê²ƒì€ ì£¼ì„ì…ë‹ˆë‹¤
nginx_http_response_count_total{status="200"}  # ë¼ì¸ ë ì£¼ì„ë„ ê°€ëŠ¥
```

<br />

:::tip

**ì¶”ì²œ í•™ìŠµ ìˆœì„œ**

- ê¸°ì´ˆ: rate(), sum(), avg()
- ì¤‘ê¸‰: increase(), irate(), topk()
- ê³ ê¸‰: ë³µì¡í•œ ë¹„ìœ¨ ê³„ì‚°, ì—¬ëŸ¬ í•¨ìˆ˜ ì¡°í•©

:::

:::note

**ì°¸ê³  ìë£Œ**

- [PromQL ê¸°ë³¸ ë¬¸ì„œ](https://prometheus.io/docs/prometheus/latest/querying/basics/)
- [PromQL í•¨ìˆ˜ ë¬¸ì„œ](https://prometheus.io/docs/prometheus/latest/querying/functions/)
- [PromQL ì‚¬ìš© ì˜ˆì œ](https://prometheus.io/docs/prometheus/latest/querying/examples/)

:::