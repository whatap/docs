홈 화면 &gt; 프로젝트 선택 &gt; <Cmdname sid="side_statistics" className="uitext" />

와탭 모니터링 서비스 초기 화면에서 프로젝트를 선택한 다음 <Cmdname sid="side_statistics" className="uitext" />의 하위 메뉴를 선택하세요. 와탭 에이전트는 트랜잭션 정보, SQL과 같은 주요 트레이스 정보에 대해 통계 정보를 수집합니다. 5분마다 목록을 만들고 서버로 전송합니다.

## 기본 화면 안내

<Cmdname sid="time_selector" className="uitext" /> 및 <Cmdname sid="filter" className="uitext" />, <Cmdname sid="order_by" className="uitext" />, <Cmdname sid="applications" className="uitext" /> 항목을 설정한 다음 ![검색 아이콘](/img/ico-btn-search.png) 버튼을 선택하세요.

<ImgLang img="apm-statistic-basic-operator.png" desc="통계" />

* 각 **통계** 메뉴는 **합계**, **최대** 및 **평균 시간** 및 **건수** 기준의 정렬 옵션을 제공해 원하는 관점으로 상위 목록을 조회할 수 있습니다. 

* <Cmdname sid="BTN06441" className="uitext" /> 버튼을 통해 기본값 외에 목록 내 조회할 컬럼을 추가하거나 제외할 수 있습니다. 

* ![검색 아이콘](/img/ico-btn-search.png) 버튼을 선택하면 조회 결과와 함께 조회 목록 위에 ![CSV 아이콘](/img/ic-csv-download-ms.svg) 버튼이 나타납니다. 버튼을 선택하면 조회 목록을 CSV 형식의 파일로 다운로드할 수 있습니다.

  :::tip

  통계 조회 목록이 표시된 이후에 조회 조건을 변경한 다음 ![검색 아이콘](/img/ico-btn-search.png) 버튼을 선택하지 않고 ![CSV 아이콘](/img/ic-csv-download-ms.svg) 버튼을 클릭하면 변경된 조건으로 CSV 파일을 다운로드할 수 있습니다.

  :::

* 통계 목록에서 ![상세 보기 아이콘](/img/ico-detail-view.svg) <Cmdname sid="display_detail" className="uitext" /> 아이콘을 선택하면 건수와 평균 시간 차트를 확인할 수 있고, 에이전트 간 건수 및 에러 건수 비교, 응답 시간 비교 차트를 추가로 제공합니다. 해당 차트에서 조회를 원하는 시점을 선택하면 <Cmdname sid="side_txSearch" className="uitext" /> 메뉴로 이동합니다.

* 통계 목록에서 <code class="btn">T</code> 버튼을 선택하면 <Cmdname sid="top_stack_of_url" className="uitext" /> 메뉴로 이동합니다.

* 통계 목록에서 <code class="btn">U</code> 버튼을 선택하면 <Cmdname sid="unique_stack_url" className="uitext" /> 메뉴로 이동합니다.

:::note

* 최대 31일 동안의 데이터를 조회할 수 있습니다. 다만, <Cmdname sid="side_statRemote" className="uitext" /> 메뉴에서는 최대 7일 동안의 데이터를 조회할 수 있습니다.

* <Cmdname sid="time_selector" className="uitext" /> 옵션 이용 방법에 대한 자세한 내용은 [다음 문서](usage-ui#timeselector)를 참조하세요.

:::


## 트랜잭션 통계

홈 화면 &gt; 프로젝트 선택 &gt; <Cmdname sid="side_statistics" className="uitext" /> &gt; <Cmdname sid="side_tx" className="uitext" />

트랜잭션 통계를 수집합니다. 5분마다 최대 5,000개의 URL 별 수행 통계를 수집하여 서버에 전송합니다. 만약 서로 다른 URL의 수가 5분 동안 5,000개가 넘으면 무시됩니다.

| 컬럼                            | 설명                              |
| ------------------------------- | --------------------------------- |
| <Cmdname sid="TTL06918" />      | 트랜잭션 주소                     |
| <Cmdname sid="count" />         | 수행 건수                         |
| <Cmdname sid="error" />         | 수행된 트랜잭션 중 에러 발생 건수 |
| <Cmdname sid="TTL06960" /> (ms) | 응답시간 합계에 대한 평균         |
| <Cmdname sid="TTL06963" /> (ms) | 응답시간의 합                     |
| <Cmdname sid="TTL06961" /> (ms) | 최대 응답시간                     |
| <Cmdname sid="TTL06965" />      | CPU 사용 시간에 대한 평균         |
| <Cmdname sid="httpc_count" />   | HTTP Call 건수                    |
| <Cmdname sid="TTL06959" /> (ms) | HTTP Call 시간의 합계에 대한 평균 |
| <Cmdname sid="TTL06097" />      | SQL 수행 건수                     |
| <Cmdname sid="TTL06956" /> (ms) | 평균 SQL 수행 시간                |
| <Cmdname sid="sqlFetch" />      | SQL 패치 건수                     |
| <Cmdname sid="TTL06953" /> (ms) | SQL 패치 시간의 합계에 대한 평균  |

:::note

<Xclude product="php">

<Cmdname sid="TTL06975" className="uitext" />은 에이전트 설정(*whatap.conf*)에서 <code>trace_malloc_enabled=true</code> 옵션을 설정해야 수집합니다. 기본값은 <code>false</code>입니다.

</Xclude>

<InDoc product="php">

<Cmdname sid="TTL06975" className="uitext" />은 에이전트 설정(*whatap.ini*)에서 <code>trace_malloc_enabled=true</code> 옵션을 설정해야 수집합니다. 기본값은 <code>false</code>입니다.

</InDoc>

:::

## 트랜잭션 도메인 통계

홈 화면 &gt; 프로젝트 선택 &gt; <Cmdname sid="side_statistics" className="uitext" /> &gt; <Cmdname sid="side_statDomain" className="uitext" />

와탭 에이전트는 도메인별 트랜잭션 통계를 수집할 수 있습니다. 하나의 서버에 여러 개의 도메인을 분리하여 서비스하는 시스템에서는 도메인 별 분석이 필요할 수 있습니다. 다음 옵션을 설정하세요.

<Xclude product="php">

```ini title='whatap.conf'
stat_domain_enabled=true
```

</Xclude>

<InDoc product="php">

```ini title='whatap.ini'
whatap.stat_domain_enabled=true
```

</InDoc>

수집되는 데이터는 도메인별 URL의 처리 현황을 파악할 수 있습니다.

| 컬럼                         | 설명                              |
| ---------------------------- | --------------------------------- |
| <Cmdname sid="TTL06101" />   | 서비스 도메인                     |
| <Cmdname sid="TTL06918" />   | 트랜잭션 주소                     |
| <Cmdname sid="count" />      | 수행 건수                         |
| <Cmdname sid="error" />      | 수행된 트랜잭션 중 에러 발생 건수 |
| <Cmdname sid="timeAvg_ms" /> | 응답시간 합계에 대한 평균         |

## 트랜잭션 Caller 통계

홈 화면 &gt; 프로젝트 선택 &gt; <Cmdname sid="side_statistics" className="uitext" /> &gt; <Cmdname sid="side_statCaller" className="uitext" />

멀티 서버가 rest 호출로 연결되면 **Caller**와 **Callee** 간의 연관 통계를 수집할 수 있습니다. 이 데이터를 수집하기 위해 다음의 옵션을 설정하세요.

<Xclude product="php">

```ini title='whatap.conf'
mtrace_rate=100
mtrace_spec=v1
stat_mtrace_enabled=true
```

</Xclude>

<InDoc product="php">

```ini title='whatap.ini'
whatap.mtrace_enabled=true 
whatap.mtrace_rate=100
whatap.mtrace_spec=v1
whatap.stat_mtrace_enabled=true
```

</InDoc>

![msa-system](https://img.whatap.io/media/agent_java/data/msa.png)

위와 같은 아키텍처에서 **Caller & Callee** 통계는 api1, api2에서만 조회할 수 있습니다. 사용자 브라우저에서 호출되는 시스템에서는 **Caller** 통계를 조회할 수 없습니다.

하지만 **Caller** 쪽 서버에서 데이터를 전송해야 하므로 모든 서버에 적절한 설정이 들어가야 합니다.

<Xclude product="php">

```ini title='whatap.conf of [front]'
mtrace_rate=100
mtrace_spec=v1
stat_mtrace_enabled=true
```

```ini title='whatap.conf of [api1] & [api2]'
mtrace_spec=v1
stat_mtrace_enabled=true
```

</Xclude>

<InDoc product="php">

```ini title='whatap.ini of [front]'
whatap.mtrace_rate=100
whatap.mtrace_spec=v1
whatap.stat_mtrace_enabled=true
```

```ini title='whatap.ini of [api1] & [api2]'
whatap.mtrace_spec=v1
whatap.stat_mtrace_enabled=true
```

</InDoc>

수집되는 통계 데이터는 다음과 같습니다. **Callee** 쪽에서 조회되어야 합니다.

| 컬럼                          | 설명                                        |
| ----------------------------- | ------------------------------------------- |
| <Cmdname sid="callerPcode" /> | Caller에 해당하는 프로젝트 코드             |
| <Cmdname sid="callerOkind" /> | Caller에 해당하는 에이전트가 속한 그룹 단위 |
| <Cmdname sid="callerUrl" />   | Caller 트랜잭션의 트랜잭션 주소             |
| <Cmdname sid="transaction" /> | Callee 트랜잭션 주소                        |
| <Cmdname sid="count" />       | 수행 건수                                   |
| <Cmdname sid="error" />       | 수행된 트랜잭션 중 에러 발생 건수           |
| <Cmdname sid="timeAvg_ms" />  | 응답시간 합계에 대한 평균                   |

:::note

<Cmdname sid="side_statCaller" className="uitext" /> 메뉴에서 한 번에 다운로드할 수 있는 CSV 라인 수는 최대 10,000줄입니다.

:::

## IP 트랜잭션 통계 {#statiptx}

홈 화면 &gt; 프로젝트 선택 &gt; <Cmdname sid="side_statistics" className="uitext" /> &gt; <Cmdname sid="side_statIp" className="uitext" />

특정 IP 주소별로 애플리케이션에서 호출한 URL과 호출 건수를 조회할 수 있는 기능을 제공합니다. 이 기능은 비정상적으로 많은 요청이 발생하는 IP 주소를 확인하고, 해당 IP 주소에서 호출된 URL을 분석하여 잠재적인 보안 위협이나 성능 이슈를 사전에 식별하는 데 유용합니다. 사용자는 이 정보를 바탕으로 불필요하거나 악의적인 요청을 차단할 수 있습니다.

<Cmdname sid="filter" className="uitext" /> 옵션을 통해 IP 주소 또는 트랜잭션 주소를 필터링하여 조건에 맞는 데이터를 빠르게 조회할 수 있습니다. 특정 IP나 트랜잭션 주소 패턴을 분석할 때 유용합니다.

| 컬럼                          | 설명                                        |
| ----------------------------- | ------------------------------------------- |
| <Cmdname sid="ip" /> | 요청을 발생시킨 클라이언트의 IP 주소 |
| <Cmdname sid="TTL06918" /> | 호출된 트랜잭션 주소, 특정 경로 변수는 `{}`로 표시 |
| <Cmdname sid="count" /> | 해당 IP 주소에서 발생한 요청의 총 건수 |
| <Cmdname sid="error" /> | 요청 중 발생한 에러 수 |
| <Cmdname sid="timeAvg_ms" />  | 해당 요청의 평균 응답 시간(밀리초, ms) |

:::tip

* **비정상적인 트래픽 감지**: 비정상적으로 호출 건수가 많은 IP를 탐지하여 해당 IP에서 발생한 트랜잭션 주소 패턴을 분석하고 잠재적인 공격을 차단할 수 있습니다. 예를 들어, 특정 IP에서 `/account/{aa}/{bb}/{cc}` URL에 대해 과도한 요청이 발생한 경우 해당 IP를 블락하거나 요청을 제한하는 조치를 취할 수 있습니다.

* **응답 시간 분석**: 평균 응답 시간이 비정상적으로 높은 IP를 확인하여 네트워크 또는 서버 측의 성능 문제를 파악하고 개선할 수 있습니다.

* **에러 발생 분석**: 특정 IP에서 에러가 다수 발생할 때 해당 IP의 요청에 문제가 있는지 또는 시스템에 특정 문제가 있는지를 진단할 수 있습니다.

:::

## 트랜잭션 Referer 통계{#stat-referer}

홈 화면 &gt; 프로젝트 선택 &gt; <Cmdname sid="side_statistics" className="uitext" /> &gt; <Cmdname sid="side_statReferer" className="uitext" />

와탭 에이전트는 Referer 별 트랜잭션 통계를 수집할 수 있습니다. 다음 옵션을 설정하세요.

<Xclude product="php">

```ini title='whatap.conf'
stat_referer_enabled=true
```

</Xclude>

<InDoc product="php">

```ini title='whatap.ini'
whatap.stat_referer_enabled=true
```

</InDoc>

수집되는 데이터는 Referer 정보를 통계로 확인할 수 있습니다.

| 컬럼                         | 설명                              |
| ---------------------------- | --------------------------------- |
| <Cmdname sid="TTL06108" />   | Referer 주소                      |
| <Cmdname sid="TTL06918" />   | 트랜잭션 주소                     |
| <Cmdname sid="count" />      | 수행 건수                         |
| <Cmdname sid="error" />      | 수행된 트랜잭션 중 에러 발생 건수 |
| <Cmdname sid="timeAvg_ms" /> | 응답시간 합계에 대한 평균         |


## 에러 통계

홈 화면 &gt; 프로젝트 선택 &gt; <Cmdname sid="side_statistics" className="uitext" /> &gt; <Cmdname sid="side_statError" className="uitext" />

5분 동안 발생한 서비스 에러에 대한 통계입니다. 서로 다른 에러와 트랜잭션 이름을 키로 발생 건수를 수집합니다. 에러 발생 시점의 스택을 제공합니다. 5분 당 최대 1,000 가지 서로 다른 에러를 통계화합니다.

| 컬럼                       | 설명           |
| -------------------------- | -------------- |
| <Cmdname sid="class" />    | 에러 클래스    |
| <Cmdname sid="TTL06918" /> | 트랜잭션 주소  |
| <Cmdname sid="msg" />      | 에러 메시지    |
| <Cmdname sid="count" />    | 에러 발생 건수 |


## SQL 수행 통계

홈 화면 &gt; 프로젝트 선택 &gt; <Cmdname sid="side_statistics" className="uitext" /> &gt; <Cmdname sid="side_statSql" className="uitext" />

5분 동안의 SQL 수행 통계를 수집합니다. 5분 동안 서로 다른 SQL 문장이 최대 5,000까지만 허용됩니다. 만약 하나의 Java 프로세스에서 한계를 넘는 SQL이 발생하면 통계 데이터에서는 버려집니다.

| 컬럼                            | 설명                                               |
| ------------------------------- | -------------------------------------------------- |
| <Cmdname sid="db" />            | 데이터베이스 종류                                  |
| <Cmdname sid="sql" />           | SQL 쿼리문                                         |
| <Cmdname sid="TTL06918" />      | 해당 SQL을 호출한 URL 중 하나를 임의로 수집한 정보 |
| CRUD                            | Create, Read, Update, Delete                       |
| <Cmdname sid="countTotal" />    | 쿼리 실행 건수                                     |
| <Cmdname sid="countError" />    | 실행된 쿼리 중 에러 발생 건수                      |
| <Cmdname sid="TTL06960" /> (ms) | 쿼리 실행 시간 합계에 대한 평균                    |
| <Cmdname sid="TTL06963" /> (ms) | 쿼리 실행 시간의 합                                |
| <Cmdname sid="TTL06964" />      | 쿼리 실행 시간에 대한 표준 편차                    |

:::info

<Cmdname sid="TTL06918" />은 5분 동안 해당 SQL을 호출한 URL 중 하나(마지막 호출 URL)를 분석 활용을 위해 수집합니다.

:::


## HTTP Call 수행 통계

홈 화면 &gt; 프로젝트 선택 &gt; <Cmdname sid="side_statistics" className="uitext" /> &gt; <Cmdname sid="side_statHttpc" className="uitext" />

HTTP 및 HTTPS 프로토콜을 통해 5분 동안의 애플리케이션 외부 호출 통계를 수집합니다. 5분 동안 서로 다른 Http Call 문장이 최대 5,000까지만 허용됩니다. 만약 하나의 애플리케이션 프로세스에서 한계를 넘는 외부 Http Call이 발생하면 통계 데이터에서는 버려집니다.

| 컬럼                         | 설명                                                    |
| ---------------------------- | ------------------------------------------------------- |
| <Cmdname sid="ITM07683" />   | HTTP 호출 URL 해시(hash)                                |
| <Cmdname sid="TTL06918" />   | 해당 HTTP API를 요청한 URL 중 하나를 임의로 수집한 정보 |
| <Cmdname sid="host" />       | Host 또는 IP 주소                                       |
| <Cmdname sid="port" />       | TCP 포트                                                |
| <Cmdname sid="total" />      | 전체 수행 건수                                          |
| <Cmdname sid="error" />      | 에러 발생 건수                                          |
| <Cmdname sid="timeAvg_ms" /> | 응답시간 합계에 대한 평균                               |
| <Cmdname sid="timeSum_ms" /> | 응답시간의 합                                           |
| <Cmdname sid="timeMin_ms" /> | 최소 응답시간                                           |
| <Cmdname sid="timeMax_ms" /> | 최대 응답시간                                           |


## 클라이언트 IP 지역별 호출 건수

홈 화면 &gt; 프로젝트 선택 &gt; <Cmdname sid="side_statistics" className="uitext" /> &gt; <Cmdname sid="side_statRemote" className="uitext" />

서버와 클라이언트의 물리적 거리는 데이터 전송 시간과 비례합니다. 클라이언트 IP의 지역별 호출 건수를 통계적으로 수집합니다. 5분당 수집할 수 있는 서로 다른 IP 수는 인스턴스 당 최대 70,000개입니다.

| 컬럼                       | 설명                 |
| -------------------------- | -------------------- |
| <Cmdname sid="TTL06081" /> | 클라이언트의 IP 주소 |
| <Cmdname sid="country" />  | 사용자 접속 국가     |
| <Cmdname sid="city" />     | 사용자 접속 도시     |
| <Cmdname sid="count" />    | 전체 호출 건수       |

:::note

* 클라이언트 IP에 대한 데이터는 최대 7일 동안의 데이터를 조회할 수 있습니다.

* 와탭은 클라이언트와 관련한 정보를 기본 저장합니다. 사용자 데이터 수집과 관련한 에이전트 설정에 대한 자세한 내용은 [다음 문서](agent-number-of-user)를 참조하세요.

:::

### 지역별 점유 비중 차트

점유 비중 차트는 사용자의 접속 위치를 국가와 도시 단위로 수집해 제시합니다. 

* 국가 영역 선택 시 해당 국가의 도시와 접속 유저의 IP 등을 확인할 수 있는 상세 차트로 이동합니다.
* 중심 원 선택 시 기존 국가 영역 선택 차트로 돌아갑니다.


## 유저 에이전트별 호출 건수

홈 화면 &gt; 프로젝트 선택 &gt; <Cmdname sid="side_statistics" className="uitext" /> &gt; <Cmdname sid="side_statUseragentDetail" className="uitext" />

유저 에이전트 문자열의 Hash별로 호출 건수를 수집합니다. 5분당 수집할 수 있는 서로 다른 User Agent Hash는 인스턴스 당 최대 500개입니다.

| 컬럼                        | 설명                               |
| --------------------------- | ---------------------------------- |
| <Cmdname sid="useragent" /> | 브라우저의 유저 에이전트 정보      |
| <Cmdname sid="os" />        | 브라우저가 실행되는 운영 체제 환경 |
| <Cmdname sid="browser" />   | 브라우저 종류                      |
| <Cmdname sid="count" />     | 수집된 전체 건수                   |


## 클라이언트 브라우저 통계

홈 화면 &gt; 프로젝트 선택 &gt; <Cmdname sid="side_statistics" className="uitext" /> &gt; <Cmdname sid="side_statUseragent" className="uitext" />

유저 에이전트의 문자열을 분석하여 최종 사용자가 사용하는 브라우저의 종류, 운영체제 기준으로 집계한 통계 정보를 제공합니다. 수집한 통계 정보를 기준으로 생성된 파이 차트를 통해 점유 비중을 확인할 수 있습니다.

| 컬럼                        | 설명                               |
| --------------------------- | ---------------------------------- |
| <Cmdname sid="useragent" /> | 브라우저의 유저 에이전트 정보      |
| <Cmdname sid="os" />        | 브라우저가 실행되는 운영 체제 환경 |
| <Cmdname sid="browser" />   | 브라우저 종류                      |
| <Cmdname sid="count" />     | 수집된 전체 건수                   |