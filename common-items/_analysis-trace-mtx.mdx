**멀티 트랜잭션**은 다른 에이전트나 프로젝트와 연관된 트랜잭션을 의미합니다. 와탭 프로젝트에 등록된 애플리케이션 서비스 간의 호출을 추적하는 것이 **멀티 트랜잭션 추적**입니다. 

<InDoc product="java">

:::info

Java 에이전트는 세 개의 HTTP 헤더 키값(`x-wtap-po`, `x-wtap-mst`, `x-wtap-sp1`)으로 멀티 트랜잭션을 추적합니다. 게이트웨이를 통과하는 HTTP 트랜잭션이 연계 추적이 안 된다면 HTTP 헤더 조건을 확인하세요.

:::

</InDoc>

:::note

**멀티 트랜잭션 활성화**

멀티 트랜잭션을 추적하려면 <Cmdname sid="management" className="uitext" /> &gt; <Cmdname sid="agent_configuration" className="uitext" /> 메뉴에서 `mtrace_enabled` 옵션을 `true`로 설정하세요. 에이전트 설정에 대한 자세한 내용은 [다음 문서](set-agent#set-agent-service)를 참조하세요.

:::

## 멀티 트랜잭션 ID 확인하기

<Cmdname sid="multi_server_transaction_trace" className="uitext" /> 메뉴를 이용하려면 <b>MTID</b>(Multi Transaction ID)가 필요합니다. 다음 과정을 통해 <b>MTID</b> 값을 확인할 수 있습니다.

1. <Cmdname sid="analysis" className="uitext" /> &gt; <Cmdname sid="AA005" className="uitext" /> 메뉴에서 차트 영역을 드래그하세요. 

1. 드래그한 차트 영역의 트랜잭션 정보가 다음과 같이 하단 <Cmdname sid="trace_list" className="uitext" /> 목록에 나타납니다.

    <ImgLang img='tx-trace-table.png' desc='mtrace_M' />

1. ![아이콘](/img/ic-s-mult-transation.svg) 아이콘이 표시된 트레이스를 선택하면 <Cmdname sid="TTL06527" className="uitext" /> 창이 나타납니다. 

1. <Cmdname sid="TTL06125" className="uitext" /> 탭에서 <Cmdname sid="TTL06107" className="uitext" /> 값을 확인할 수 있습니다. 

    <ImgLang img='tx-trace-dt-up.png' desc='레코드 요약' />

:::note

* 트랜잭션에서 외부 호출을 하는 경우에도 동일한 <Cmdname sid="TTL06107" className="uitext" />가 생성됩니다. 서비스별로 프로젝트가 분리되어 있더라도 처음 발급한 <Cmdname sid="TTL06107" className="uitext" />를 통해 애플리케이션 간의 모든 트랜잭션을 확인할 수 있습니다. <Cmdname sid="TTL06527" className="uitext" /> 창을 활용한 트랜잭션 트레이스 상세 분석에 관한 자세한 내용은 [다음 문서](trs-profile#transaction-info)를 참조하세요.

* <Cmdname sid="TTL06527" className="uitext" /> 창에서 <Cmdname sid="TTL06107" className="uitext" />를 선택하면 <Cmdname sid="TTL06377" className="uitext" /> 탭으로 이동합니다. 시스템 내 또는 시스템 간에 발생하는 다양한 호출 관계를 한 눈에 파악하고 어느 부분에서 문제가 발생했는지 식별하여 개선할 수 있도록 트랜잭션과 트레이스 정보를 제공합니다.

:::

## 멀티 트랜잭션 추적 기능 이용하기

1. <Cmdname sid="analysis" className="uitext" /> &gt; <Cmdname sid="multi_server_transaction_trace" className="uitext" /> 메뉴로 이동하세요.

1. <Cmdname sid="TTL06527" className="uitext" /> 창에서 확인한 <b>MTID</b> 값을 <Cmdname sid="search_mtid_or_custid" className="uitext" /> 항목에 입력하세요.

1. 조회할 날짜와 프로젝트를 선택하세요.

1. 화면 아래에 <Cmdname sid="apply" className="uitext" /> 버튼을 클릭하세요.

    * 다음 조건에서 화면 하단의 <Cmdname sid="apply" className="uitext" /> 버튼이 비활성화됩니다.

        * 이전 검색과 동일한 필터값(MTID/CUSTID, 날짜, 선택 프로젝트)을 설정한 경우

        * 필터값(MTID/CUSTID, 날짜, 선택 프로젝트)을 하나도 입력하지 않은 경우

1. 오른쪽 <Cmdname sid="BTN07120" className="uitext" /> 탭에 각 트랜잭션의 호출 관계를 파악할 수 있는 다이어그램과 테이블이 표시됩니다.

   {/* <ImgLang img='trace-mtx-mtid-chart.png' desc='멀티 트랜잭션 추적' /> */}

    :::tip

    다이어그램과 테이블 영역은 상하로 구분되어 그 비율을 직접 조절할 수 있습니다.

    - 위쪽 화살표를 클릭하면 테이블이 전체 영역을 차지합니다. 단, 다이어그램 영역이 전체 영역을 차지하고 있었다면 다이어그램과 테이블이 각각 절반의 영역으로 나뉩니다.
    - 아래쪽 화살표를 클릭하면 차트 영역이 전체 영역을 차지합니다. 단, 테이블 영역이 전체 영역을 차지하고 있었다면 다이어그램과 테이블이 각각 절반의 영역으로 나뉩니다. 

    :::

### <Cmdname sid="BTN07120" />

<Cmdname sid="BTN07120" className="uitext" />는 각 트랜잭션의 호출 관계를 빠르고 명확하게 사용자에게 제공합니다. 동일한 <Cmdname sid="TTL06107" className="uitext" />를 갖는 트랜잭션 서비스들의 개별 수행 시간을 확인할 수 있습니다. 트랜잭션 노드의 상단에 표현되어 있는 소요시간(<LinkImage img="number-01.png" desc="number 1"/> <Cmdname sid="time_bar" className="uitext" />)를 통해 트랜잭션 간 호출 관계를 확인할 수 있습니다.

![Chart](/img/trace-mtx-chart-timebar.png)

:::tip

차트는 마우스로 자유롭게 이동하거나 확대, 축소할 수 있습니다.

- 차트 영역을 드래그하면 원하는 위치로 이동할 수 있습니다.

- 차트 영역을 스크롤하면 원하는 위치로 이동할 수 있습니다.
    - 상하 스크롤: 상하 이동
    - 좌우 스크롤: 좌우 이동

- `Ctrl`+ 스크롤로 차트를 확대하거나 축소할 수 있습니다.
    - 터치패드의 확대, 축소 동작으로도 가능합니다.

:::

트랜잭션을 선택하면 연결된 노드만 활성화되고, 연결 관계없는 모든 노드는 흐리게 표시됩니다. 선택된 트랜잭션의 하단의 <LinkImage img="number-02.png" desc="number 2"/> **상세보기** 버튼이 활성화되며, 클릭 시 <Cmdname sid="TTL06527" className="uitext" /> 창이 열립니다. 해당 트랜잭션의 상세 내역을 확인할 수 있습니다. <Cmdname sid="TTL06527" className="uitext" /> 창을 활용한 트랜잭션 트레이스 상세 분석에 관한 자세한 내용은 [다음 문서](trs-profile#transaction-info)를 참고하세요.

* 확대, 축소 동작 버튼: 현재 확대 배율과 확대 축소 동작을 할 수 있습니다.
* 화면에 맞춤 버튼: 모든 노드를 화면에 맞게 표시합니다.
* 확대 축소 초기화 버튼: 차트의 표시 위치와 확대 정도를 최초 상태로 초기화 합니다.
* 차트 뷰 설정: 차트에 표시할 요소를 표시하거나 숨길 수 있습니다.
    * <Cmdname sid="TTL06344" className="uitext" />: 애플리케이션 명, 프로젝트 정보, IP 정보, 상태 코드를 표시하거나 숨길 수 있습니다.
    * <Cmdname sid="database" className="uitext" /> / <Cmdname sid="apply_external_remote" className="uitext" />: 해당 트랜잭션에서 발생한 다른 데이터베이스 커넥션 요청이나 HTTP Call의 정보 또한 차트의 노드로 확인할 수 있습니다.

--- 

* **A**<Cmdname sid="small" className="uitext" /> / **A**<Cmdname sid="big" className="uitext" />: 노드에 표시된 폰트 크기를 조절할 수 있습니다.

* <Cmdname sid="time_bar" className="uitext" />: 각 노드에 소요 시간(<Cmdname sid="time_bar" className="uitext" />)을 표시하거나 숨길 수 있습니다.

* <Cmdname sid="application_name" className="uitext" />: 각 노드에 에이전트 이름(oname)을 표시하거나 숨길 수 있습니다.

* <Cmdname sid="project" className="uitext" />: 각 노드에 프로젝트 이름을 표시하거나 숨길 수 있습니다.

* <Cmdname sid="database" className="uitext" /> / <Cmdname sid="apply_external_remote" className="uitext" /> / <Cmdname sid="apply_internal_remote" className="uitext" />: 해당 트랜잭션에서 발생한 다른 데이터베이스 커넥션 요청이나 HTTP Call의 정보 또한 차트의 노드로 확인할 수 있습니다.

### <Cmdname sid="BTN07121" />

<Cmdname sid="BTN07121" className="uitext" /> 탭에서는 멀티 트랜잭션 내에 포함된 각 트랜잭션 별 정보를 테이블 형식으로 확인할 수 있습니다.

<ImgLang img='trace-mtx-table.png' desc='테이블' />

각 트랜잭션 항목을 선택하면 <Cmdname sid="BTN07120" className="uitext" /> 탭의 노드 선택과 마찬가지로 선택한 트랜잭션에 대한 <Cmdname sid="TTL06527" className="uitext" /> 창이 나타납니다. 트랜잭션 트레이스를 통해 해당 트랜잭션의 상세 내역을 확인할 수 있습니다. <Cmdname sid="TTL06527" className="uitext" /> 창을 활용한 트랜잭션 트레이스 상세 분석에 관한 자세한 내용은 [다음 문서](trs-profile#transaction-info)를 참조하세요.

![컬럼 아이콘](/img/ic-column.svg) <Cmdname sid="BTN06441" className="uitext" />: 테이블 내 컬럼을 편집할 수 있습니다. 


### <Cmdname sid="BTN06296" />

<Cmdname sid="BTN06296" className="uitext" /> 탭에서는 각 트랜잭션과 그에 속해 있는 트레이스의 세부 정보를 확인할 수 있습니다. 전체 트랜잭션 소요 시간 내의 각 하위 트랜잭션이나 트레이스의 시작 및 소요 시간을 시각화해 트랜잭션 호출 관계를 트리 형식으로 제공합니다.

<ImgLang img='trace-mtx-tree.png' desc='Tree' />

* ![한 줄 보기 아이콘](/img/ic-single-line.svg) <Cmdname sid="BTN06368" className="uitext" />: 각 구간 별 수행 정보에 표시된 텍스트를 한 줄로 표시해 트리 형식을 간격하게 정리할 수 있습니다.

* ![여러 줄 보기 아이콘](/img/ic-multi-line.svg) <Cmdname sid="BTN06369" className="uitext" />: 각 구간 별 수행 정보에 표시된 텍스트를 줄바꿈해 모두 표시합니다.

* <Cmdname sid="BTN06327" className="uitext" />: 가장 긴 경로로 이동할 수 있습니다.

* ![차트 아이콘](/img/ic-bar-chart.svg) <Cmdname sid="BTN06743" className="uitext" />: 경과 시간을 막대 형식의 차트로 표시합니다.

* ![시간 아이콘](/img/ic-custom-time.svg) <Cmdname sid="BTN06744" className="uitext" />: 각 구간별 타임 스탬프, 갭, 경과 시간을 텍스트 형식으로 표시합니다.

  * 8초 이상: <span class='etrs'>초과 지연</span> 상태로 <span class='etrs'>빨간색</span>으로 표현합니다.

  * 3초 이상 8초 미만: <span class='ov5ud10'>지연</span> 상태로 <span class='ov5ud10'>주황색</span>으로 표현합니다.

  * 3초 미만: <span class='woer'>정상</span> 상태로 <span class='woer'>파란색</span>으로 표현합니다.

  :::note

  시작 및 소요 시간의 경우 트랜잭션 호출 환경에 따라 발생하는 시차를 상위 트랜잭션 내 트레이스와 매핑을 통해 보정하여 표현하기 때문에 실제 수집된 시간 데이터와 차이가 발생할 수 있습니다.

  :::

* ![감추기 아이콘](/img/ic-eye-invisible.svg) <Cmdname sid="BTN06745" className="uitext" />: 시간 정보를 숨깁니다.

:::note

해당 트레이스의 ![통계 아이콘](/img/ic-static.svg) 버튼 또는 ![팝업 아이콘](/img/ic-popup.svg) 버튼을 선택하면 <Cmdname sid="remote_http_call_statistics" className="uitext" />, <Cmdname sid="activestack" className="uitext" /> 등의 요약 창을 확인할 수 있습니다.

:::

:::tip

SQL 변수와 HTTP 쿼리를 조회하려면 다음 옵션을 에이전트 설정에 추가하세요.

* SQL 파라미터 정보 기록과 관련한 에이전트 설정은 [다음 문서](agent-dbsql#profile-sql-param)를 참조하세요.

* HTTP 파라미터 정보 기록과 관련한 에이전트 설정은 [다음 문서](agent-transaction#profile_http_parameter)를 참조하세요.

```ini title='whatap.conf'
# SQL 파라미터 조회 옵션: 옵션이 적용되면 SQL 파라미터를 암호화하여 수집합니다.
profile_sql_param_enabled=true 

# HTTP 파라미터 조회 옵션: 옵션이 적용되면 HTTP 쿼리 파라미터를 암호화하여 수집합니다.
profile_http_parameter_enabled=true 
```

:::