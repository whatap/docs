---
id: auto-instrument
title: ê¸°ë³¸ ì‚¬ìš©ë²•
description: whatap-go-inst ë„êµ¬ë¡œ ì½”ë“œ ìˆ˜ì • ì—†ì´ Go ì• í”Œë¦¬ì¼€ì´ì…˜ì— ëª¨ë‹ˆí„°ë§ì„ ì¶”ê°€í•˜ëŠ” ë°©ë²•ì„ ì•ˆë‚´í•©ë‹ˆë‹¤.
keywords: [ Go, whatap-go-inst, ìë™ ì„¤ì • ]
---

Go ëª¨ë‹ˆí„°ë§ ìë™ ì ìš©ì€ ì™€íƒ­ì—ì„œ ê°œë°œí•œ **whatap-go-inst** ë„êµ¬ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤. `whatap-go-inst`ëŠ” ë¹Œë“œ ì‹œ ëª¨ë‹ˆí„°ë§ ì½”ë“œë¥¼ ìë™ìœ¼ë¡œ ì‚½ì…í•˜ëŠ” CLI ë„êµ¬ë¡œ, ì†ŒìŠ¤ì½”ë“œë¥¼ ì§ì ‘ ìˆ˜ì •í•  í•„ìš”ê°€ ì—†ìŠµë‹ˆë‹¤.

`whatap-go-inst` ì„¤ì¹˜ë¥¼ ìœ„í•´ ì•„ë˜ **ì§€ì› í™˜ê²½**ì„ í™•ì¸í•œ í›„ **ë¹ ë¥¸ ì‹œì‘** ë‹¨ê³„ë¥¼ í™•ì¸í•˜ì„¸ìš”. 

:::info ë‹¤ë¥¸ ì„¤ì • ë°©ë²•

APIë¥¼ ì§ì ‘ ì‚¬ìš©í•˜ì—¬ ëª¨ë‹ˆí„°ë§ ì½”ë“œë¥¼ ì¶”ê°€í•˜ë ¤ë©´ [ìˆ˜ë™ ì„¤ì • ê°€ì´ë“œ](manual-instrument)ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.

:::

## ì§€ì› í™˜ê²½

| í•­ëª© | ìš”êµ¬ì‚¬í•­ | ë¹„ê³  |
|------|----------|------|
| **Go ë²„ì „** | 1.18 ì´ìƒ | go-api ë¼ì´ë¸ŒëŸ¬ë¦¬ ìš”êµ¬ì‚¬í•­ |
| **OS** | Linux | amd64, arm64 |

:::note

whatap-go-inst ë°”ì´ë„ˆë¦¬ ìì²´ëŠ” Go ì„¤ì¹˜ ì—†ì´ë„ ì‹¤í–‰ ê°€ëŠ¥í•©ë‹ˆë‹¤. ë‹¨, ê³„ì¸¡ëœ ì½”ë“œë¥¼ ë¹Œë“œí•˜ë ¤ë©´ Go 1.18 ì´ìƒì´ í•„ìš”í•©ë‹ˆë‹¤.

:::

## ë¹ ë¥¸ ì‹œì‘

### 1ë‹¨ê³„: whatap-go-inst ì„¤ì¹˜

whatap-go-inst ì„¤ì¹˜ ë°©ë²•ì€ ë‹¤ìŒ 3ê°€ì§€ì…ë‹ˆë‹¤. í™˜ê²½ì— ë§ëŠ” ë°©ë²•ì„ ì„ íƒí•˜ì„¸ìš”.

#### Go install ì„¤ì¹˜ (ê¶Œì¥)

Go 1.21 ì´ìƒì—ì„œ ê¶Œì¥í•˜ëŠ” ì„¤ì¹˜ ë°©ë²•ì…ë‹ˆë‹¤.
```bash
go install github.com/whatap/go-api-inst/cmd/whatap-go-inst@latest
```

#### ë°”ì´ë„ˆë¦¬ ì§ì ‘ ì„¤ì¹˜

Go ì„¤ì¹˜ ì—†ì´ ì§ì ‘ ì„¤ì¹˜í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤. Go 1.18-1.20 ì‚¬ìš©ìëŠ” ì´ ë°©ë²•ì„ ì‚¬ìš©í•˜ì„¸ìš”.
```bash
# Linux (amd64)
curl -sSL https://github.com/whatap/go-api-inst/releases/latest/download/whatap-go-inst_linux_amd64.tar.gz | tar xz
sudo mv whatap-go-inst /usr/local/bin/

# Linux (arm64)
curl -sSL https://github.com/whatap/go-api-inst/releases/latest/download/whatap-go-inst_linux_arm64.tar.gz | tar xz
sudo mv whatap-go-inst /usr/local/bin/
```

#### ì†ŒìŠ¤ì—ì„œ ë¹Œë“œ

```bash
git clone https://github.com/whatap/go-api-inst.git
cd go-api-inst
go build -o whatap-go-inst .
```

### 2ë‹¨ê³„: í”„ë¡œì íŠ¸ ì´ˆê¸°í™”

í”„ë¡œì íŠ¸ ë£¨íŠ¸(go.modê°€ ìˆëŠ” ë””ë ‰í† ë¦¬)ì—ì„œ ì‹¤í–‰í•˜ì„¸ìš”.

```bash
whatap-go-inst init
```

ì´ ëª…ë ¹ì–´ëŠ” ë‹¤ìŒ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤:
- í”„ë¡œì íŠ¸ ë¶„ì„ ë° ì‚¬ìš© ì¤‘ì¸ í”„ë ˆì„ì›Œí¬ ê°ì§€
- `whatap_inst.tool.go` íŒŒì¼ ìƒì„±
- `go.mod`ì— whatap ì˜ì¡´ì„± ì¶”ê°€

### 3ë‹¨ê³„: ë¹Œë“œ ë° ì‹¤í–‰
```bash
# ëª¨ë‹ˆí„°ë§ ì½”ë“œê°€ ìë™ìœ¼ë¡œ ì‚½ì…ë˜ì–´ ë¹Œë“œë©ë‹ˆë‹¤
whatap-go-inst go build ./...

# ì‹¤í–‰
./myapp
```

:::tip ì™„ë£Œ!

ì´ì œ [WhaTap ëª¨ë‹ˆí„°ë§ ì„œë¹„ìŠ¤](https://service.whatap.io)ì—ì„œ ë°ì´í„°ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

:::

<details>
<summary>ğŸ’¡ ì›ë³¸ ì½”ë“œë¥¼ ì „í˜€ ë³€ê²½í•˜ê³  ì‹¶ì§€ ì•Šë‹¤ë©´?</summary>

wrap ëª¨ë“œë¥¼ ì‚¬ìš©í•˜ë©´ `whatap_inst.tool.go` íŒŒì¼ì´ë‚˜ `go.mod` ë³€ê²½ ì—†ì´ ë¹Œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```bash
# init ì—†ì´ ë°”ë¡œ ë¹Œë“œ
whatap-go-inst go --wrap build ./...
```

**wrap ëª¨ë“œ íŠ¹ì§•**
- ì›ë³¸ í”„ë¡œì íŠ¸ íŒŒì¼ ë³€ê²½ ì—†ìŒ
- ì²« í…ŒìŠ¤íŠ¸ë‚˜ ì„ì‹œ ì ìš©ì— ìœ ìš©
- ë§¤ë²ˆ `--wrap` ì˜µì…˜ í•„ìš”

</details>

---

## whatap-go-inst ìƒì„¸ ì„¤ëª…

### ì‘ë™ ì›ë¦¬

`whatap-go-inst`ëŠ” ë¹Œë“œ ì‹œ ì†ŒìŠ¤ì½”ë“œë¥¼ ë¶„ì„í•˜ì—¬ ëª¨ë‹ˆí„°ë§ ì½”ë“œë¥¼ ìë™ìœ¼ë¡œ ì‚½ì…í•©ë‹ˆë‹¤.

#### 1. main() í•¨ìˆ˜ ì´ˆê¸°í™”
```go
// ë³€ê²½ ì „
func main() {
    // ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œ
}

// ë³€ê²½ í›„
func main() {
    trace.Init(nil)         // ìë™ ì¶”ê°€
    defer trace.Shutdown()  // ìë™ ì¶”ê°€
    
    // ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œ
}
```

#### 2. ì›¹ í”„ë ˆì„ì›Œí¬ ë¯¸ë“¤ì›¨ì–´
```go
// ë³€ê²½ ì „
r := gin.Default()
r.GET("/api", handler)

// ë³€ê²½ í›„
r := gin.Default()
r.Use(whatapgin.Middleware())  // ìë™ ì¶”ê°€
r.GET("/api", handler)
```

#### 3. ë°ì´í„°ë² ì´ìŠ¤ í˜¸ì¶œ
```go
// ë³€ê²½ ì „
db, _ := sql.Open("mysql", dsn)

// ë³€ê²½ í›„
db, _ := whatapsql.Open("mysql", dsn)  // ìë™ ë³€ê²½
```

### ì§€ì›í•˜ëŠ” ì£¼ìš” ë¼ì´ë¸ŒëŸ¬ë¦¬

- **ì›¹ í”„ë ˆì„ì›Œí¬**: Gin, Echo, Fiber, Chi, Gorilla Mux, net/http, FastHTTP
- **ë°ì´í„°ë² ì´ìŠ¤**: database/sql, sqlx, GORM v1/v2
- **ìºì‹œ/NoSQL**: Redis (go-redis, Redigo), MongoDB
- **ì™¸ë¶€ ì„œë¹„ìŠ¤**: gRPC, Kafka (Sarama), Kubernetes client-go
- **ë¡œê·¸**: log, logrus, zap

<details>
<summary>ì „ì²´ ì§€ì› ë¼ì´ë¸ŒëŸ¬ë¦¬ ëª©ë¡ ë³´ê¸°</summary>

| ë¶„ë¥˜ | ì§€ì› ë¼ì´ë¸ŒëŸ¬ë¦¬ |
|------|----------------|
| **ì›¹ í”„ë ˆì„ì›Œí¬** | Gin, Echo v4, Fiber v2, Chi v5, Gorilla Mux, net/http, FastHTTP |
| **ë°ì´í„°ë² ì´ìŠ¤** | database/sql, sqlx, GORM v1/v2 |
| **Redis** | go-redis v8/v9, Redigo |
| **NoSQL** | MongoDB |
| **ë©”ì‹œì§€í** | Kafka (Sarama - IBM/Shopify) |
| **RPC** | gRPC |
| **Kubernetes** | client-go |
| **ë¡œê·¸** | log, logrus, zap |

</details>

---

### ëª…ë ¹ì–´

|    êµ¬ë¶„    | ëª…ë ¹ì–´                    | ì„¤ëª…                             | ì£¼ìš” ì‚¬ìš©   |
| :--------: | ------------------------- | -------------------------------- | ----------- |
| **ì´ˆê¸°í™”** | `whatap-go-inst init`     | í”„ë¡œì íŠ¸ ì´ˆê¸°í™” ë° ì˜ì¡´ì„± ì¶”ê°€   | ìµœì´ˆ 1íšŒ    |
|  **ê¸°ë³¸**  | `whatap-go-inst go build` | ëª¨ë‹ˆí„°ë§ ì½”ë“œë¥¼ ì‚½ì…í•˜ì—¬ ë¹Œë“œ    | ì¼ë°˜ ë¹Œë“œ   |
|  **ê¸°ë³¸**  | `whatap-go-inst go run`   | ëª¨ë‹ˆí„°ë§ ì½”ë“œë¥¼ ì‚½ì…í•˜ì—¬ ì‹¤í–‰    | ê°œë°œ/í…ŒìŠ¤íŠ¸ |
|  **ê¸°ë³¸**  | `whatap-go-inst go test`  | ëª¨ë‹ˆí„°ë§ ì½”ë“œë¥¼ ì‚½ì…í•˜ì—¬ í…ŒìŠ¤íŠ¸  | ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ |
|  **ê³ ê¸‰**  | `whatap-go-inst inject`   | ê³„ì¸¡ ì½”ë“œë¥¼ ë³„ë„ ë””ë ‰í† ë¦¬ì— ì¶œë ¥ | ì½”ë“œ ê²€í†    |
|  **ê³ ê¸‰**  | `whatap-go-inst remove`   | ì‚½ì…ëœ ëª¨ë‹ˆí„°ë§ ì½”ë“œ ì œê±°        | ê³„ì¸¡ í•´ì œ   |
|  **ìœ í‹¸**  | `whatap-go-inst version`  | ë²„ì „ í™•ì¸                        | ë²„ì „ ì²´í¬   |

:::tip

`whatap-go-inst go` ë’¤ì—ëŠ” ì¼ë°˜ `go` ëª…ë ¹ì–´ì™€ ë™ì¼í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```bash
# ì˜ˆì‹œ: ì¼ë°˜ go ëª…ë ¹ì–´ì²˜ëŸ¼ ì‚¬ìš©
whatap-go-inst go build -o myapp -ldflags="-s -w" .
```

:::

### ì£¼ìš” ì˜µì…˜

#### whatap-go-inst go ì˜µì…˜

| ì˜µì…˜ | ì„¤ëª… |
|------|------|
| `--wrap` | wrap ëª¨ë“œ (go.mod ë³€ê²½ ì—†ìŒ) |
| `--error-tracking` | ì—ëŸ¬ ì¶”ì  ì½”ë“œ ì‚½ì… (`if err != nil` íŒ¨í„´ì— `trace.Error` ì¶”ê°€) |

**ì‚¬ìš© ì˜ˆì‹œ:**
```bash
# wrap ëª¨ë“œ
whatap-go-inst go --wrap build ./...

# ì—ëŸ¬ ì¶”ì  í¬í•¨
whatap-go-inst go --error-tracking build ./...
```

#### inject/remove ì˜µì…˜

| ì˜µì…˜ | ì„¤ëª… |
|------|------|
| `-s, --src` | ì†ŒìŠ¤ì½”ë“œ ê²½ë¡œ |
| `-o, --output` | ì¶œë ¥ ë””ë ‰í† ë¦¬ |
| `--all` | (removeë§Œ) ìˆ˜ë™ ì‚½ì… íŒ¨í„´ë„ ì œê±° ì‹œë„ |

**ì‚¬ìš© ì˜ˆì‹œ:**

```bash
# ê³„ì¸¡ ì½”ë“œ ë³„ë„ ì €ì¥
whatap-go-inst inject -s ./src -o ./instrumented

# ê³„ì¸¡ ì½”ë“œ ì œê±°
whatap-go-inst remove -s ./instrumented -o ./clean
```

### ì „ì—­ ì˜µì…˜

ëª¨ë“  ëª…ë ¹ì–´ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê³µí†µ ì˜µì…˜ì…ë‹ˆë‹¤.

| ì˜µì…˜ | ì„¤ëª… |
|------|------|
| `--verbose, -v` | ìƒì„¸ ì¶œë ¥ (íŒŒì¼ë³„ ë³€í™˜ ë‚´ìš© í‘œì‹œ) |
| `--quiet, -q` | ìš”ì•½ë§Œ ì¶œë ¥ |
| `--config` | ì„¤ì • íŒŒì¼ ê²½ë¡œ (ê¸°ë³¸: `.whatap/config.yaml`) |
| `--report` | JSON ë³´ê³ ì„œ íŒŒì¼ ê²½ë¡œ |

**ì‚¬ìš© ì˜ˆì‹œ:**

```bash
# ìƒì„¸ ì¶œë ¥
whatap-go-inst -v go build ./...

# ì„¤ì • íŒŒì¼ ì§€ì •
whatap-go-inst --config ./my-config.yaml go build ./...
```

---

## ìì£¼ ë¬»ëŠ” ì§ˆë¬¸

### ì›ë³¸ ì½”ë“œê°€ ë³€ê²½ë˜ë‚˜ìš”?

ë„¤, í•˜ì§€ë§Œ ìµœì†Œí•œìœ¼ë¡œë§Œ ë³€ê²½ë©ë‹ˆë‹¤:
- `whatap_inst.tool.go` íŒŒì¼ 1ê°œ ì¶”ê°€
- `go.mod`ì— whatap ì˜ì¡´ì„± ì¶”ê°€

ì›ë³¸ì„ ì „í˜€ ë³€ê²½í•˜ê³  ì‹¶ì§€ ì•Šë‹¤ë©´ `--wrap` ëª¨ë“œë¥¼ ì‚¬ìš©í•˜ì„¸ìš”.

### ê¸°ì¡´ go ëª…ë ¹ì–´ì™€ ë¬´ì—‡ì´ ë‹¤ë¥¸ê°€ìš”?

`whatap-go-inst go build`ëŠ” ì¼ë°˜ `go build`ì™€ ë™ì¼í•˜ê²Œ ì‘ë™í•˜ì§€ë§Œ, ë¹Œë“œ ì „ì— ëª¨ë‹ˆí„°ë§ ì½”ë“œë¥¼ ìë™ìœ¼ë¡œ ì‚½ì…í•©ë‹ˆë‹¤. ëª¨ë“  ì˜µì…˜ê³¼ í”Œë˜ê·¸ëŠ” ê·¸ëŒ€ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```bash
# ì¼ë°˜ ë¹Œë“œ ëª…ë ¹ì–´ì™€ ë™ì¼í•˜ê²Œ ì‚¬ìš©
whatap-go-inst go build -o myapp -ldflags="-s -w" .
```

### ë¹Œë“œ ì‹œê°„ì´ ëŠë ¤ì§€ë‚˜ìš”?

ì´ˆê¸° ë¹Œë“œëŠ” ì•½ê°„ ëŠë ¤ì§ˆ ìˆ˜ ìˆì§€ë§Œ, Goì˜ ë¹Œë“œ ìºì‹œ ë•ë¶„ì— ì´í›„ ë¹Œë“œëŠ” ê±°ì˜ ì˜í–¥ì´ ì—†ìŠµë‹ˆë‹¤.

### ê³„ì¸¡ì´ ì ìš©ë˜ì§€ ì•ŠëŠ” ê²ƒ ê°™ì€ë°ìš”?

ë‹¤ìŒì„ í™•ì¸í•´ë³´ì„¸ìš”:
```bash
# ë¹Œë“œ ìºì‹œ ì‚­ì œ í›„ ì¬ë¹Œë“œ
go clean -cache
whatap-go-inst go build ./...

# ë””ë²„ê·¸ ëª¨ë“œë¡œ ìƒì„¸ ë¡œê·¸ í™•ì¸
GO_API_AST_DEBUG=1 whatap-go-inst go build ./...
```

ë” ìì„¸í•œ ë‚´ìš©ì€ [ì„¤ì • ê°€ì´ë“œ](auto-instrument-config#íŠ¸ëŸ¬ë¸”ìŠˆíŒ…)ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.

### Docker í™˜ê²½ì—ì„œë„ ì‚¬ìš©í•  ìˆ˜ ìˆë‚˜ìš”?

ë„¤, Dockerfileì—ì„œ ë™ì¼í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
```dockerfile
FROM golang:1.21 AS builder

WORKDIR /app

# whatap-go-inst ì„¤ì¹˜
RUN go install github.com/whatap/go-api-inst/cmd/whatap-go-inst@latest

# ì†ŒìŠ¤ ë³µì‚¬
COPY . .

# ì´ˆê¸°í™” ë° ë¹Œë“œ
RUN whatap-go-inst init
RUN whatap-go-inst go build -o /app/myapp .

FROM alpine:latest
COPY --from=builder /app/myapp /app/myapp
CMD ["/app/myapp"]
```

ìì„¸í•œ ë‚´ìš©ì€ [Docker ì„¤ì¹˜ ê°€ì´ë“œ](install-agent-docker)ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.
