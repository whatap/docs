---
id: install-docker-nodejs-temp
title: Docker Node.js 설치
description: 컨테이너 내 Node.js 애플리케이션을 모니터링하기 위한 에이전트 설치 단계입니다.
tags: [ 쿠버네티스, 쿠버네티스 모니터링, 애플리케이션 설치, Node.js ]
draft: true
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

***관리*** > ***에이전트 설치*** > 하단의 ***애플리케이션 설치*** 클릭 > 설치 안내 중 ***Docker Node.js*** 탭 선택

Docker 컨테이너 기반으로 실행하는 Node.js 애플리케이션에 와탭 모니터링 에이전트를 적용하고 컨테이너 이미지를 패키징하는 과정을 다음과 같이 안내합니다. 

:::note 

* EKS Fargate는 지원 예정입니다. 

* Node.js 애플리케이션 연동 과정에 대한 이해를 돕고자 Git 예시 코드를 제공합니다. [다음 문서](https://github.com/whatap/kuber-apm-boilerplate/tree/main/nodejs/express)를 참조하세요.

:::

## 에이전트 다운로드

다음 명령어를 통해 whatap을 설치하세요.

```bash
npm install --save whatap
```

업데이트를 진행하려면 다음 명령어를 실행하세요.

```bash
npm update whatap
```

## 에이전트 설정

*node_modules/whatap* 경로에 위치한 *whatap.conf* 파일을 Node.js 애플리케이션 루트 디렉토리로 복사하세요. 다음 내용을 참고해 복사한 *whatap.conf* 파일을 수정하세요.

```ini
license=XXXXXXXXXXXXXX-XXXXXXXXXXXXXX-XXXXXXXXXXXXXX
whatap.server.host={수집 서버 IP}
whatap_micro_enabled=true
```

## 사용법

애플리케이션 메인 모듈의 첫 줄에 다음 코드를 추가하세요.

```javascript title='Example' showLineNumbers {1}
var WhatapAgent = require('whatap').NodeAgent;

WhatapAgent.NodeAgent;
import http from 'http';
import setupApp from '../src/app';
let server = null;
const port = normalizePort(process.env.PORT || '3000');
```

ECMAScript(ES)를 활용한다면 다음 코드를 추가하세요.

```javascript
import WhatapAgent from 'whatap';
WhatapAgent.NodeAgent;
```

## 컨테이너 환경변수

Docker 빌드 후 쿠버네티스 환경 내 **컨테이너 환경변수**를 설정하세요. 애플리케이션 배포 *yaml* 파일에 다음 내용을 추가하세요. 

```yaml
env:
- name: NODE_IP
  valueFrom: {fieldRef: {fieldPath: status.hostIP}}
- name: NODE_NAME
  valueFrom: {fieldRef: {fieldPath: spec.nodeName}}
- name: POD_NAME
  valueFrom: {fieldRef: {fieldPath: metadata.name}}
- name: OKIND
	value: {YOUR_OKIND_NAME}
- name: license
	value: {licenseKey}
- name: whatap_server_host
	value: {proxyServer}
- name: whatap_micro_enabled
	value: "true"
```

다음 예시를 참조하세요.

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: # Pod Name
  labels: # Pod Labels
spec:
  containers:
	  env:
    - name: NODE_IP
      valueFrom: {fieldRef: {fieldPath: status.hostIP}}
    - name: NODE_NAME
      valueFrom: {fieldRef: {fieldPath: spec.nodeName}}
    - name: POD_NAME
      valueFrom: {fieldRef: {fieldPath: metadata.name}}
		- name: license
			value: {licenseKey}
		- name: whatap_server_host
			value: {proxyServer}
		- name: whatap_micro_enabled
			value: "true"
```

{@include: _k8s-env-role.mdx} 

{@include: _check-install-agent.mdx}