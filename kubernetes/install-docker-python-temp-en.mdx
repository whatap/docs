---
id: install-docker-python-temp-en
title: Installing Docker Python
description: This step allows you to install the agent to monitor Python applications in the container.
tags:
  - Kubernetes
  - Kubernetes Monitoring
  - Application Installation
  - Python
draft: false
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

At the bottom of ***Management*** > ***Agent installation***, click ***Install Application*** > Select the ***Docker Python*** tab in Install guide.

This process applies the WhaTap monitoring agent to the Python application running on the Docker container and packages the container image as follows. To release the Kubernetes application, the Docker image is required. Create a Docker image with the whatap-python package installed using the following process.

:::note 

-   EKS Fargate is to be supported later. 

-   Git example code is provided to help you understand the Python application integration process. See [the following](https://github.com/whatap/kuber-apm-boilerplate/tree/main/python/fastapi).

:::

## Download agent

Install the whatap-python package when building your Python application docker image.

```docker
RUN pip3 install --upgrade whatap-python
```

See the following definition example of the following Dockerfile. 

```docker title='python ver 3.10'
# python3.10을 도커환경에 설치합니다.
FROM python:3.10

# 작업 디렉토리를 /app 으로 설정합니다.
WORKDIR /app

# 현재 디렉토리의 모든 파일과 폴더를 컨테이너 내의 /app 디렉토리에 복사합니다.
ADD . /app/

# 파이썬에서는 pip를 이용하여 외부 라이브러리를 설치할 수 있습니다. 
# 와탭 파이썬 에이전트를 도커 이미지 빌드시 설치합니다.
RUN pip3 install --upgrade whatap-python
```

## Configuration and execution of the agent

Before running the application, determine the Python agent's working directory and then create a default configuration file. Pass the authentication information to the agent and set whether or not to trace logs through the configuration file (*entrypoint.sh*).

<details>
<summary>Configuration file (entrypoint.sh) example</summary>

```bash title='entrypoint.sh'
#!/bin/bash

# 컨테이너의 작업 디렉터리를 와탭 경로로 설정하세요. 해당 경로에 에이전트 로그 및 설정 파일을 생성합니다.
export WHATAP_HOME=${PWD}

# 권한 오류 발생 시 다음 주석을 제거 후 진행하세요.
#chmod -R 777 $WHATAP_HOME

# 다음은 에이전트 구성에 필수적인 설정 값입니다. 애플리케이션 배포 yaml 파일을 통해 설정합니다.
whatap-setting-config \
--host $whatap_server_host \
--license $license \
--app_name $app_name \
--app_process_name $app_process_name

# 다음 주석은 에이전트 그룹화 및 로그 수집 활성화 등의 추가 설정입니다. 필요한 경우에만 사용하세요.

# 에이전트 그룹화
#echo "okind=$okind" >> whatap.conf

# 로그 수집 활성화
#echo "logsink_enabled=true" >> whatap.conf
#echo "logsink_trace_enabled=true" >> whatap.conf
#echo "trace_logging_enabled=true" >> whatap.conf


# 다음과 같이 whatap-start-agent를 애플리케이션 시작 명령어 앞에 추가해 에이전트를 실행하세요. 
whatap-start-agent uvicorn server:app --host 0.0.0.0 --port 8000
```

</details>

1.  Set the container's working directory with the `WHATAP_HOME` environment variable. Create the agent log and configuration files in the path. 

    ```bash
    export WHATAP_HOME=${PWD}
    ```

2.  Execute the following command to create and configure the *whatap.conf* file in the path set as `WHATAP_HOME`. Variables marked with `$` are required for agent configuration and are set through the *yaml* file for releasing the application.

    ```bash
    whatap-setting-config \
    --host $whatap_server_host \
    --license $license \
    --app_name $app_name \
    --app_process_name $app_process_name
    ```

3.  Run the agent by adding `whatap-start-agent` before the application startup command as follows: 

```bash
whatap-start-agent uvicorn server:app --host 0.0.0.0 --port 8000
```

:::caution

If any role issues, assign roles to the `$WHATAP_HOME` variable as follows:

```bash
echo `sudo chmod -R 777 $WHATAP_HOME`
```

:::

:::note 

-   As an example of the *yaml* file, see [Container environment variable settings](#k8s-env) as follows:

-   The `license` is the user authentication information of WhaTap. **Do not expose to outside**.

:::

### Script running example

See the following definition example of the following Dockerfile. This is a complete example to run the *entrypoint.sh* script.

```docker
FROM python:3.10
WORKDIR /app
ADD . /app/
RUN pip3 install --upgrade whatap-python 

#entrypoint.sh 스크립트을 컨테이너에서 실행할 수 있도록 권한을 부여합니다.
RUN chmod +x ./entrypoint.sh

# 컨테이너 생성시 entrypoint.sh 스크립트를 실행합니다.
CMD ["./entrypoint.sh"]
```

### Additional function

The following settings are optional and must be used if necessary. In addition to the following additional settings in the configuration file (*entrypoint.sh*), log and transaction-related settings are also configurable. For additional settings, see [the following](https://docs.whatap.io/python/set-agent). 

-   **Agent grouping** 

    ```bash
    echo "okind=$okind" >> whatap.conf
    ```

-   **Enabling the log collection** 

    ```bash
    echo "logsink_enabled=true" >> whatap.conf
    echo "logsink_trace_enabled=true" >> whatap.conf
    echo "trace_logging_enabled=true" >> whatap.conf
    ```

## Configuring the container environment variables {#k8s-env}

After building Docker, set **container environment variables** in the Kubernetes environment. Add the following items in the *yaml* file for releasing the application. 

```yaml
	  env:
		- name: license
			value: XXXXXXXXXXXXXX-XXXXXXXXXXXXXX-XXXXXXXXXXXXXX
		- name: whatap_server_host
			value: XXX.XXX.XXX.XXX
		- name: app_name
			value: {YOUR_APP_NAME}
		- name: app_process_name
		  value: {YOUR_PROCESS_NAME}
		- name: okind
			value: {YOUR_GROUP_NAME}
		- name: NODE_IP
		  valueFrom: {fieldRef: {fieldPath: status.hostIP}}
		- name: NODE_NAME
		  valueFrom: {fieldRef: {fieldPath: spec.nodeName}}
		- name: POD_NAME
		  valueFrom: {fieldRef: {fieldPath: metadata.name}}
```

See the following example: 

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: python-fastapi-deployment
spec:
  replicas: 3
  selector:
    matchLabels:
      app: python-fastapi-pod
  template:
    metadata:
      labels:
        app: python-fastapi-pod
  containers:
	- name: agent-python-fastapi
    image: whatap/agent-python-fastapi
	  env:
		- name: license
			value: XXXXXXXXXXXXXX-XXXXXXXXXXXXXX-XXXXXXXXXXXXXX
		- name: whatap_server_host
			value: XXX.XXX.XXX.XXX
		- name: app_name
			value: "myapp-python-fastapi"
		- name: app_process_name
		  value: "uvicorn"
		- name: NODE_IP
		  valueFrom: {fieldRef: {fieldPath: status.hostIP}}
		- name: NODE_NAME
		  valueFrom: {fieldRef: {fieldPath: spec.nodeName}}
		- name: POD_NAME
		  valueFrom: {fieldRef: {fieldPath: metadata.name}}
```

:::note

**Roles of environment variables**

-   `license`: Key for agent authentication.

-   `whatap_server_host`: Host IP of the WhaTap collection server.

-   `app_name`: The agent naming scheme to identify applications.

-   `app_process_name`: The agent naming scheme to identify applications. It sets the target process to collect data of the application server such as CPU and heap memory. 

-   `okind` (optional): Groups applications for Pods. If set to a deployment name, the corresponding Pods are grouped together.

-   `NODE_IP`: Collects the IP address of the node where the current Pod has been hosted.

-   `NODE_NAME`: Collects the name of the node where the current Pod is running.

-   `POD_NAME`: Collects the name of the current Pod.

:::

## Checking the agent installation

-   To check whether the agent has been installed, go to ***Dashboard*** > ***Application Service Dashboard***.

-   Run the `ps -ef | grep whatap_python` command in the container to check whether the Whatap Python service is running normally. 