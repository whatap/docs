---
id: set-aws-resource-options
title: AWS 리소스 정보 수집 옵션
description: AWS 환경에서 리소스 정보를 수집하여 토폴로지 화면에 표현할 수 있습니다.
tags: [ 네트워크 성능 모니터링, 에이전트, AWS, Amazon Linux ]
---

AWS 환경에서 네트워크 성능 모니터링을 사용하려면 각 리소스(LB 등)에 연결된 ENI 정보를 수집하여 토폴로지에 표현할 수 있습니다. AWS 요소에 에이전트를 직접 설치할 수 없기 때문에 수집된 IP 기준으로 연관된 ENI를 확인하여 표현합니다.

![Example](/img/npm-aws-resource-example.png)

AWS의 ELB를 통해 내부에 트래픽이 인가되는 경우 그림과 같이 ENI에 표현된 정보를 통해 토폴로지에 표현할 수 있습니다. AWS ENI에 `Description` 필드를 기준으로 표현합니다. 만약 `Description` 필드에 아무런 정보를 남기지 않은 경우 `NetworkInterfaceId` 속성을 제공합니다.

## 에이전트 옵션 및 권한 설정

*/usr/whatap/whatap-npmd/whatap.conf* 파일에 다음과 같이 옵션을 설정하세요. 대괄호([ ]) 부분에는 AWS에서 발급 받은 인증 정보를 입력하세요. 이 때 필요한 사용자 권한은 `ec2:DescribeNetworkInterfaces`입니다.

```ini title='whatap.conf'
awsInfoEnable=1
# AWS access key
awsAccessKey=[User Access Key]
# AWS secret access key
awsSecretKey=[User Secret Key]
# Region
awsRegions=[RegionCode1,RegionCode2,...]
```

다음 명령어를 이용해 옵션을 추가할 수 있습니다.

```bash
echo "awsInfoEnable=1" |  tee -a /usr/whatap/whatap-npmd/whatap.conf > /dev/null
echo "awsAccessKey=[User Access Key]" |  tee -a /usr/whatap/whatap-npmd/whatap.conf > /dev/null
echo "awsSecretKey=[User Secret Key]"  |  tee -a /usr/whatap/whatap-npmd/whatap.conf > /dev/null
echo "awsRegions=[RegionCode1,RegionCode2,...]" |  tee -a /usr/whatap/whatap-npmd/whatap.conf > /dev/null

sudo service whatap-npmd restart
```

* **awsInfoEnable**

  AWS 정보 조회 사용 여부를 설정합니다. 기본값은 `0`이며 AWS 정보를 조회하려면 `1`로 설정하세요.

* **awsAccessKey**

  사용자의 AWS access key(액세스 키)를 입력하세요.

* **awsSecretKey**

  사용자의 AWS secret access Key(비밀 액세스 키)를 입력하세요.

* **awsRegions**

  사용자의 리소스가 포함된 리전을 입력하세요. 멀리 리전을 사용한다면 쉼표(,)를 구분자로 입력하세요.

:::note

* AWS의 AccessKey 생성에 대한 자세한 내용은 [다음 링크](https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html?icmpid=docs_iam_console#Using_CreateAccessKey)를 참조하세요.

* `ec2:DescribeNetworkInterfaces`: 선택한 서브넷의 기존 네트워크 인터페이스를 조회하고 선택합니다.

:::

:::tip

쿠버네티스 환경의 경우 다음 이미지를 참조해 YAML 파일에 노란색 박스 영역의 내용을 추가하세요.

![K8s example](/img/npm-aws-resource-k8s-example.png)

대괄호([ ]) 부분에는 AWS에서 발급 받은 인증 정보를 입력하세요.

```yaml
echo "awsInfoEnable=1" |  tee -a /usr/whatap/whatap-npmd/whatap.conf > /dev/null
echo "awsAccessKey=[User Access Key]" |  tee -a /usr/whatap/whatap-npmd/whatap.conf > /dev/null
echo "awsSecretKey=[User Secret Key]"  |  tee -a /usr/whatap/whatap-npmd/whatap.conf > /dev/null
echo "awsRegions=[RegionCode1,RegionCode2,...]" |  tee -a /usr/whatap/whatap-npmd/whatap.conf > /dev/null
```

:::

