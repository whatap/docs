---
id: multi-tx
title: 멀티 트랜잭션
description: 멀티 트랜잭션 추적을 안내합니다. 
keywords: [ 트랜잭션, 멀티 트랜잭션, 멀티 트랜잭션 추적, UI ]
draft: true
---

**멀티 트랜잭션**은 다른 에이전트나 프로젝트와 연관된 트랜잭션을 의미합니다. 와탭 프로젝트에 등록된 애플리케이션 서비스 간의 호출을 추적하는 것이 **멀티 트랜잭션 추적**입니다. 

:::note

**멀티 트랜잭션 활성화**

멀티 트랜잭션을 추적하려면 활성화 옵션을 설정해야 합니다. 

1. ***관리*** > ***에이전트 설정*** 메뉴로 이동하세요. 
1. ***멀티서버 트랜잭션*** 설정 하위의 ***활성화*** 옵션 `mtrace_enabled`의 값을 `true`로 지정하세요.

:::

## 멀티 트랜잭션 추적

홈 화면 > 프로젝트 선택 > ***분석*** > ***히트맵*** 메뉴에서 차트 영역을 드래그하세요. 드래그한 차트 영역의 트랜잭션 정보가 다음과 같이 하단 ***TX 트레이스*** 목록에 나타납니다. 목록에서 멀티 트랜잭션을 포함한 트랜잭션은 ![아이콘](/img/ic-s-mult-transation.svg) 아이콘이 표시됩니다.

![mtrace_M](/img/tx-trace-table.png)

해당 트레이스를 선택하면 ***통계*** 정보 창이 나타납니다. 멀티 트랜잭션이 추적되는 경우 상단 요약 정보 탭의 ***멀티 트랜잭션***에서 ***MTID*** 값을 확인할 수 있습니다. 트랜잭션에서 외부 호출을 하는 경우에도 동일한 ***MTID***가 생성됩니다. 서비스별로 프로젝트가 분리되어 있더라도 처음 발급한 ***MTID***를 통해 애플리케이션 간의 모든 트랜잭션을 확인할 수 있습니다. ***통계*** 창을 활용한 TX 트레이스 상세 분석에 관한 자세한 내용은 [다음 문서](trs-profile#details)를 참조하세요.

![mtrace_apm](/img/tx-trace-dt-up.png)

***MTID*** 옆의 ![오른쪽 화살표 아이콘](/img/ic-arrow-right.svg) 아이콘을 선택하면 ***분석*** > ***멀티 트랜잭션 추적*** 메뉴로 이동합니다. ***멀티 트랜잭션 추적*** 메뉴에서 시스템 내 또는 시스템 간에 발생하는 다양한 호출 관계를 한 눈에 파악하고 어느 부분에서 문제가 발생했는지 식별하여 개선할 수 있도록 트랜잭션과 트레이스 정보를 제공합니다. 

![멀티 트랜잭션 차트 sc](/img/multi-tx-cht.png)

![number 1](/img/number-01.png) 영역은 ***필터 패널***입니다. 검색을 위한 특정 키 값(***MTID*** / ***CUSTID***)이나 프로젝트 리스트를 편집해 정보를 필터링할 수 있습니다. 적용된 필터는 오른쪽 ![number 2](/img/number-02.png) 표현되는 탭 리스트인 ***차트 뷰***, ***테이블 뷰***, ***트리 뷰*** 각 탭에 일괄 적용됩니다.

### 차트 뷰

***멀티 트랜잭션 추적*** 메뉴의 기본 화면은 ***차트 뷰***입니다. ***차트 뷰*** 탭에서는 각 트랜잭션의 호출 관계를 빠르고 명확하게 사용자에게 제공합니다. 동일한 ***MTID***를 갖는 트랜잭션 서비스들의 개별 수행 시간을 확인할 수 있습니다. 트랜잭션 노드의 배경색으로 표현되어 있는 소요 시간(***타임바***)를 통해 트랜잭션 간 호출 관계를 확인할 수 있습니다. 

***차트 뷰*** ![number 3](/img/number-03.png) 영역 상단 옵션을 통해 ***타임바***를 포함한 추가 정보를 확인할 수 있습니다. ***폰트 크기*** 버튼을 선택하면 차트에 표현되는 폰트의 크기를 조절할 수 있습니다. ***타임바***, ***애플리케이션명***, ***프로젝트*** 버튼을 선택하면 노드에서 표현되는 정보를 제어할 수 있습니다. 오른쪽에 위치한 버튼 집합인 ***데이터베이스***, ***외부 호출***, ***내부 호출*** 버튼을 선택하면 해당 트랜잭션에서 발생한 다른 데이터베이스 커넥션 요청이나 HTTP Call의 정보 또한 차트의 노드로 확인할 수 있습니다.

트랜잭션 노드를 선택하면 다음과 같이 ***통계*** 창이 나타납니다. 트랜잭션 트레이스를 통해 해당 트랜잭션의 상세 내역을 확인할 수 있습니다. ***통계*** 창을 활용한 트랜잭션 트레이스 상세 분석에 관한 자세한 내용은 [다음 문서](../trs-profile#details)를 참조하세요

![멀티 트랜잭션 상세 보기](/img/multi-tx-stat.png)

### 테이블 뷰

***테이블 뷰*** 탭을 선택하면 테이블 형식으로 멀티 트랜잭션 내에 포함된 각 트랜잭션 별 정보를 확인할 수 있습니다. ![컬럼 선택 아이콘](/img/ic-column.svg) ***컬럼 선택*** 아이콘을 선택해 테이블 내 컬럼을 편집할 수 있습니다. 

![멀티 트랜잭션 테이블 뷰](/img/multi-tx-tb.png)

![상세 아이콘](/img/ic-pageview.svg)상세 아이콘을 선택하면 ***차트 뷰*** 노드 선택과 마찬가지로 ***통계*** 창이 나타납니다. 트랜잭션 트레이스를 통해 해당 트랜잭션의 상세 내역을 확인할 수 있습니다. ***통계*** 창을 활용한 트랜잭션 트레이스 상세 분석에 관한 자세한 내용은 [다음 문서](../trs-profile#details)를 참조하세요.

### 트리 뷰

***트리 뷰*** 탭을 선택하면 각 트랜잭션과 그에 속해있는 트레이스의 세부 정보를 확인할 수 있습니다. 전체 트랜잭션 소요 시간 내의 각 하위 트랜잭션이나 트레이스의 시작 및 소요 시간을 시각화해 트랜잭션 호출 관계를 트리 형식으로 제공합니다. 

![멀티 트랜잭션 트리 뷰](/img/multi-tx-tr.png)

![number 4](/img/number-04.png) 영역은 트리 구조로 표현되는 세부 정보 표현 방식 옵션입니다. ***한 줄 보기***와 ***여러 줄 보기***의 두 가지 방식을 제공합니다. ***한 줄 보기*** 표현 방식이 기본 설정입니다. 상단 버튼을 통해 일괄적으로 제어할 수 있고 각 행을 선택해 개별적인 표현 방식 전환이 가능합니다.

![number 5](/img/number-05.png) 영역은 소요 시간 옵션입니다. ![타임바 아이콘](/img/ic-dashbaord-bar-chart-h.svg) ***타임바***, ![타임셋 아이콘](/img/ic-custom-time.svg) ***타임셋***, ![숨김 처리 아이콘](/img/ic-eye-invisible.svg) ***숨김 처리*** 세 가지 방식을 제공합니다. 시작 및 소요 시간의 경우 트랜잭션 호출 환경에 따라 발생하는 시차를 상위 트랜잭션 내 트레이스와 매핑을 통해 보정하여 표현하기 때문에 실제 수집된 시간 데이터와 차이가 발생할 수 있습니다. 소요 시간은 해당 값에 따라 다음과 같이 색상으로 표현합니다.

* 8초 이상: <span class='etrs'>초과 지연</span> 상태로 <span class='etrs'>빨간색</span>으로 표현합니다.

* 3초 이상 8초 미만: <span class='ov5ud10'>지연</span> 상태로 <span class='ov5ud10'>주황색</span>으로 표현합니다.

* 3초 미만: <span class='woer'>정상</span> 상태로 <span class='woer'>파란색</span>으로 표현합니다.

![number 6](/img/number-06.png) 영역은 각 트레이스 유형에 따라 통계나 쿼리 정보 등을 확인할 수 있는 전용 옵션을 제공합니다. 해당 트레이스의 ![통계 아이콘](/img/ic-static.svg) 아이콘 또는 ![팝업 아이콘](/img/ic-popup.svg) 아이콘을 선택하면 ***HTTP 호출 통계***, ***액티브 스택*** 등의 요약 창을 확인할 수 있습니다.

## 참고 자료

* [멀티 트랜잭션 메뉴 추가](https://www.whatap.io/ko/blog/85/index.html)
* [멀티트랜잭션 다이어그램 개편](https://www.whatap.io/ko/blog/72/index.html)

<!-- 

멀티 트랜잭션을 추적하려면 에이전트 설정 파일에 다음 옵션을 설정하세요. `mtrace_enabled`는 값이 `true`일 때 기본값 10% 비율로 멀티 트랜잭션을 추적합니다.  

```ini title='whatap.conf'
mtrace_enabled=true 
```

단일 APM에서 분리된 모든 트랜잭션을 수집하면 부하가 많이 걸리기 때문에 하나의 트랜잭션에 연계된 트랜잭션을 같이 수집하는 것입니다. 

예시의 ![통계 아이콘](/img/ic-static.svg) 아이콘을 선택하면 ***HTTP 호출 통계*** 요약 창이 나타납니다. ***상세 >*** 버튼을 선택하면 ***통계/보고서*** > ***통계*** 메뉴로 이동해 상세 정보를 확인할 수 있습니다.  각 요약 창에서 ***상세 >*** 버튼을 선택하면 ***통계/보고서*** > ***통계*** 메뉴로 이동해 상세 정보를 확인할 수 있습니다. 

-->

<!-- 
 * ![왼쪽 아이콘](/img/ic-metrics-cube-back.svg) 아이콘을 선택하면 ***프로젝트 목록***을 숨기고 차트에 집중할 수 있도록 ***차트 뷰*** 영역을 확장시킬 수 있습니다.
 같은 프로젝트에 속한 애플리케이션 서비스들 간의 호출 관계는 트레이스 내에서 데이터를 확인할 수 있습니다.
-->

<!--

1. 홈 화면 > 프로젝트 선택 > ***분석*** > ***히트맵*** 메뉴에서 차트 영역을 드래그하세요.<br/>
  드래그한 차트 영역의 트랜잭션 정보가 다음과 같이 하단 ***TX 트레이스*** 목록에 나타납니다. 목록에서 멀티 트랜잭션을 포함한 트랜잭션은 ![아이콘](/img/ic-s-mult-transation.svg) 아이콘이 표시됩니다.
  
  ![mtrace_M](/img/tx-trace-table.png)

1. 해당 트레이스를 선택하면 ***통계*** 정보 창이 나타납니다.<br/>
  멀티 트랜잭션이 추적되는 경우 상단 요약 정보 탭의 ***멀티 트랜잭션***에서 **MTID** 값을 확인할 수 있습니다. 트랜잭션에서 외부 호출을 하는 경우에도 동일한 **MTID**가 생성됩니다. 업무별로 프로젝트가 분리되어 있더라도 처음 발급한 **MTID**를 통해 애플리케이션 간의 모든 트랜잭션을 확인할 수 있습니다. ***통계*** 창을 활용한 TX 트레이스 상세 분석에 관한 자세한 내용은 [다음 문서](trs-profile#details)를 참조하세요.

  ![mtrace_apm](/img/tx-trace-dt-up.png)

1. ***멀티 트랜잭션*** **MTID** 옆의 ![오른쪽 화살표 아이콘](/img/ic-arrow-right.svg) 아이콘을 선택하면 ***분석*** > ***멀티 트랜잭션 추적*** 메뉴로 이동합니다.<br/>
  ***멀티 트랜잭션 추적*** 메뉴의 기본 화면은 ***차트 뷰***입니다.

  ![멀티 트랜잭션 차트](/img/multi-tx-cht.png)

   ***차트 뷰*** 탭에서는 시스템 내 또는 시스템 간에 발생하는 다양한 호출 관계를 한 눈에 파악하고 어느 부분에서 문제가 발생했는지 식별하여 개선할 수 있도록 트랜잭션과 프로파일 정보를 제공합니다. 동일한 **MTID**를 갖는 트랜잭션 서비스들의 개별 수행 시간을 확인할 수 있습니다.

1. ***테이블 뷰*** 탭을 선택하세요.<br/>
  ***테이블 뷰*** 탭에서는 티어별 트랜잭션 트레이스 정보를 확인할 수 있습니다. 

  ![멀티 트랜잭션 테이블 뷰](/img/multi-tx-tb.png)

  ![상세 아이콘](/img/ic-pageview.svg)상세 아이콘을 선택하면 ***통계*** 창이 나타납니다. 같은 프로젝트에 속한 애플리케이션 서비스 간의 호출 관계를 확인할 수 있습니다. 

  ![멀티 트랜잭션 상세 보기](/img/multi-tx-stat.png)

-->

<!--

차트뷰

  ![mtrace-mtid](https://img.whatap.io/media/images/Screenshot_2020-12-17_W_JAVA_DEMO_5490_-_Application_Monitoring11.png) 
  ![mtrace-apm-tableview](https://img.whatap.io/media/images/Screenshot_2020-12-17_W_JAVA_DEMO_5490_-_Application_Monitoring12.png)
  ![mtrace-apm-13](https://img.whatap.io/media/images/Screenshot_2020-12-17_W_JAVA_DEMO_5490_-_Application_Monitoring13.png)

-->